
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modeling Mental Health with Poisson Regression &#8212; Modeling Mental Health</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Modeling_Mental_Health';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Modeling Mental Health" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="Modeling Mental Health - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="Modeling Mental Health - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Modeling Mental Health
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Modeling Mental Health with Poisson Regression</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Modeling_Mental_health" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Modeling_Mental_health/issues/new?title=Issue%20on%20page%20%2FModeling_Mental_Health.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Modeling_Mental_Health.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modeling Mental Health with Poisson Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing"><strong>Data preprocessing</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-encoding"><strong>Standard encoding</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-data-types"><strong>Changing  data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#poisson-model"><strong>Poisson Model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-poisson-regression"><strong>Why Poisson regression?</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation"><strong>Estimation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-deviation-of-coefficients"><strong>Standard deviation of coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-coefficients"><strong>Confidence intervals for  coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction"><strong>Prediction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection"><strong>Predictors Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-test"><strong>Significance test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit"><strong>Goodness of fit</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#deviance"><strong>Deviance</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-ratio-test-as-significance-test"><strong>Likelihood Ratio Test as significance test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection-based-on-predictive-performance"><strong>Predictors selection based on predictive performance</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#train-train-train-validate-split"><strong>Train-Train - Train-Validate split</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection-algorithm"><strong>Best subset selection algorithm</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection-algorithm"><strong>Backward selection algorithm</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-algorithm"><strong>Forward selection algorithm</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction intervals</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-monte-linear-regression-formula"><strong>Using Monte Linear Regression formula</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-monte-carlo-simulation"><strong>Using Monte Carlo Simulation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-theory"><strong>Coefficient Interpretation: theory</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#without-interactions"><strong>Without interactions</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#with-interactions"><strong>With interactions</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-application"><strong>Coefficient Interpretation: application</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modeling-mental-health-with-poisson-regression">
<h1><strong>Modeling Mental Health with Poisson Regression</strong><a class="headerlink" href="#modeling-mental-health-with-poisson-regression" title="Link to this heading">#</a></h1>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="c1">#import sys</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#sys.path.insert(0, &#39;C:/Users/fscielzo/Documents/DataScience-GitHub/EDA&#39;)</span>
<span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span> <span class="n">dtypes_df</span><span class="p">,</span> <span class="n">change_type</span><span class="p">,</span> <span class="n">count_col_nulls</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="p">,</span> <span class="n">outliers_table</span><span class="p">,</span> <span class="n">scatter_matrix</span><span class="p">,</span> <span class="n">boxplot_2D_matrix</span><span class="p">,</span> <span class="n">histogram_2D_matrix</span><span class="p">,</span> <span class="n">ecdf_2D_matrix</span> 
<span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span>  <span class="n">histogram</span><span class="p">,</span> <span class="n">freq_table</span><span class="p">,</span> <span class="n">outlier_filter</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">boxplot</span><span class="p">,</span> <span class="n">ecdfplot</span><span class="p">,</span> <span class="n">stripplot_matrix</span><span class="p">,</span> <span class="n">transform_to_dummies</span><span class="p">,</span> <span class="n">cross_quant_cat_summary</span><span class="p">,</span> <span class="n">quant_to_cat</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conceptual-description-of-the-data">
<h2><strong>Conceptual description of the data</strong><a class="headerlink" href="#conceptual-description-of-the-data" title="Link to this heading">#</a></h2>
<p>The Behavioral Risk Factor Surveillance System (BRFSS) is a health-related telephone survey that is collected annually by the CDC. Each year, the survey collects responses from over 400,000 Americans on health-related risk behaviors, chronic health conditions, and the use of preventative services. It has been conducted every year since 1984. For this project, a csv of the dataset available on Kaggle for the year 2015 was used. This original dataset contains responses from 441,455 individuals and has 330 features. These features are either questions directly asked of participants, or calculated variables based on individual participant responses.</p>
<p>This dataset contains 70,692 survey responses to the CDC’s BRFSS2015. It has an equal 50-50 split of respondents with no diabetes and with either prediabetes or diabetes.
22 variables has been colleted from the survey.</p>
<p>The following table summarize conceptually the variables contained in the data set with which we will work along this project.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Diabetes</span></code></p></td>
<td><p>0 = no diabetes ; 1 = prediabetes or diabetes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HighBP</span></code></p></td>
<td><p>0 = no high blood pressure ; 1 = high blood pressure</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">HighChol</span></code></p></td>
<td><p>0 = no high cholesterol ; 1 = high cholesterol</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CholCheck</span></code></p></td>
<td><p>0 = no cholesterol check in 5 years ; 1 = yes cholesterol check in 5 years</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code></p></td>
<td><p>Body Mass Index</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Smoker</span></code></p></td>
<td><p>Have you smoked at least 100 cigarettes in your entire life? [Note: 5 packs = 100 cigarettes] 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Stroke</span></code></p></td>
<td><p>Have you had a stroke (ictus). 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HeartDiseaseorAttack</span></code></p></td>
<td><p>coronary heart disease (CHD) or myocardial infarction (MI). 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PhysActivity</span></code></p></td>
<td><p>physical activity in past 30 days - not including job. 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Fruits</span></code></p></td>
<td><p>Consume Fruit 1 or more times per day. 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Veggies</span></code></p></td>
<td><p>Consume Vegetables 1 or more times per day. 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HvyAlcoholConsump</span></code></p></td>
<td><p>(adult men &gt;=14 drinks per week and adult women&gt;=7 drinks per week). 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AnyHealthcare</span></code></p></td>
<td><p>Have any kind of health care coverage, including health insurance, prepaid plans such as HMO, etc. 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NoDocbcCost</span></code></p></td>
<td><p>Was there a time in the past 12 months when you needed to see a doctor but could not because of cost? 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GenHlth</span></code></p></td>
<td><p>Would you say that in general your health is: scale 1-5. 1 = excellent ; 2 = very good ; 3 = good ; 4 = fair ; 5 = poor</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MentHlth</span></code></p></td>
<td><p>Now thinking about your mental health, which includes stress, depression, and problems with emotions, for how many days during the past 30 days was your mental health not good? scale 1-30 days</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PhysHlth</span></code></p></td>
<td><p>Now thinking about your physical health, which includes physical illness and injury, for how many days during the past 30 days was your physical health not good? scale 1-30 days</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DiffWalk</span></code></p></td>
<td><p>Do you have serious difficulty walking or climbing stairs? 0 = no ; 1 = yes</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Sex</span></code></p></td>
<td><p>0 = female ; 1 = male</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Age</span></code></p></td>
<td><p>13-level age category. 0 = [18, 24] ; 1 = [25 ,29 ]   ; 2 = [30 ,34 ]   ; 3 = [35 ,39 ]    ; 4 = [40 , 44]    ; 5 = [ 45, 49]    ; 6 = [50 , 54]    ; 7 = [55 , 59]    ; 8 = [60 , 64]  ; 9 = [65 , 69] ; 10 = [70 , 74]  ; 11 = [75 , 79]  ; 12 = 80 or older</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Education</span></code></p></td>
<td><p>Education level scale 0-5. 0 = Never attended school or only kindergarten ; 1 = Elementary ; 2 = Some high school ; 3 = High school graduate ; 4 = Some college or technical school ; 5 = College graduate</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Income</span></code></p></td>
<td><p>Income scale scale 0-7. 0 = lower than 0k ; 1 = [10k, 15k) ; 2 = [15k, 20k) ; 3 = [20k, 25k) ; 4 = [25k, 35k) ; 5 = [35k, 50k) ; 6 = [50k, 75k) ; 7 = higher than 75k</p></td>
<td><p>Multiclass</p></td>
</tr>
</tbody>
</table>
<p>the data has been obtained from <code class="docutils literal notranslate"><span class="pre">Kaggle</span></code>:  <a class="reference external" href="https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset">https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset</a></p>
</section>
<section id="reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#reading-the-data" title="Link to this heading">#</a></h2>
<p>First of all, we read the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mental_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;mental_health_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mental_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 22)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th><th>HighBP</th><th>HighChol</th><th>CholCheck</th><th>BMI</th><th>Smoker</th><th>Stroke</th><th>HeartDiseaseorAttack</th><th>PhysActivity</th><th>Fruits</th><th>Veggies</th><th>HvyAlcoholConsump</th><th>AnyHealthcare</th><th>NoDocbcCost</th><th>GenHlth</th><th>MentHlth</th><th>PhysHlth</th><th>DiffWalk</th><th>Sex</th><th>Age</th><th>Education</th><th>Income</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>26.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>3.0</td><td>5.0</td><td>30.0</td><td>0.0</td><td>1.0</td><td>4.0</td><td>6.0</td><td>8.0</td></tr><tr><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>26.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>3.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>12.0</td><td>6.0</td><td>8.0</td></tr><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>26.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>10.0</td><td>0.0</td><td>1.0</td><td>13.0</td><td>6.0</td><td>8.0</td></tr><tr><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>28.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>3.0</td><td>0.0</td><td>3.0</td><td>0.0</td><td>1.0</td><td>11.0</td><td>6.0</td><td>8.0</td></tr><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>29.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>2.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>8.0</td><td>5.0</td><td>8.0</td></tr><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>18.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>7.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>4.0</td><td>7.0</td></tr><tr><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>26.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>13.0</td><td>5.0</td><td>6.0</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mental_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(70692, 22)
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preprocessing">
<h2><strong>Data preprocessing</strong><a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<p>In this section we are going to carry out some preprocessing tasks on the data.</p>
<section id="data-types">
<h3><strong>Data types</strong><a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<p>We check the variables data types according to <code class="docutils literal notranslate"><span class="pre">polars</span></code> structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dtypes_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">mental_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (22, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;Diabetes&quot;</td><td>Float64</td></tr><tr><td>&quot;HighBP&quot;</td><td>Float64</td></tr><tr><td>&quot;HighChol&quot;</td><td>Float64</td></tr><tr><td>&quot;CholCheck&quot;</td><td>Float64</td></tr><tr><td>&quot;BMI&quot;</td><td>Float64</td></tr><tr><td>&quot;Smoker&quot;</td><td>Float64</td></tr><tr><td>&quot;Stroke&quot;</td><td>Float64</td></tr><tr><td>&quot;HeartDiseaseor…</td><td>Float64</td></tr><tr><td>&quot;PhysActivity&quot;</td><td>Float64</td></tr><tr><td>&quot;Fruits&quot;</td><td>Float64</td></tr><tr><td>&quot;Veggies&quot;</td><td>Float64</td></tr><tr><td>&quot;HvyAlcoholCons…</td><td>Float64</td></tr><tr><td>&quot;AnyHealthcare&quot;</td><td>Float64</td></tr><tr><td>&quot;NoDocbcCost&quot;</td><td>Float64</td></tr><tr><td>&quot;GenHlth&quot;</td><td>Float64</td></tr><tr><td>&quot;MentHlth&quot;</td><td>Float64</td></tr><tr><td>&quot;PhysHlth&quot;</td><td>Float64</td></tr><tr><td>&quot;DiffWalk&quot;</td><td>Float64</td></tr><tr><td>&quot;Sex&quot;</td><td>Float64</td></tr><tr><td>&quot;Age&quot;</td><td>Float64</td></tr><tr><td>&quot;Education&quot;</td><td>Float64</td></tr><tr><td>&quot;Income&quot;</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="unique-values">
<h3><strong>Unique values</strong><a class="headerlink" href="#unique-values" title="Link to this heading">#</a></h3>
<p>We compute the unique values of each variable, what is useful to get a more real idea of their nature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mental_df</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mental_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>HighBP</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>HighChol</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>CholCheck</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (80,)</small><table border="1" class="dataframe"><thead><tr><th>BMI</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>12.0</td></tr><tr><td>13.0</td></tr><tr><td>14.0</td></tr><tr><td>15.0</td></tr><tr><td>16.0</td></tr><tr><td>17.0</td></tr><tr><td>18.0</td></tr><tr><td>19.0</td></tr><tr><td>20.0</td></tr><tr><td>21.0</td></tr><tr><td>22.0</td></tr><tr><td>23.0</td></tr><tr><td>&hellip;</td></tr><tr><td>80.0</td></tr><tr><td>81.0</td></tr><tr><td>82.0</td></tr><tr><td>83.0</td></tr><tr><td>84.0</td></tr><tr><td>85.0</td></tr><tr><td>86.0</td></tr><tr><td>87.0</td></tr><tr><td>89.0</td></tr><tr><td>92.0</td></tr><tr><td>95.0</td></tr><tr><td>98.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Smoker</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Stroke</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>HeartDiseaseorAttack</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>PhysActivity</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Fruits</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Veggies</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>HvyAlcoholConsump</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>AnyHealthcare</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>NoDocbcCost</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5,)</small><table border="1" class="dataframe"><thead><tr><th>GenHlth</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (31,)</small><table border="1" class="dataframe"><thead><tr><th>MentHlth</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr><tr><td>6.0</td></tr><tr><td>7.0</td></tr><tr><td>8.0</td></tr><tr><td>9.0</td></tr><tr><td>10.0</td></tr><tr><td>11.0</td></tr><tr><td>&hellip;</td></tr><tr><td>19.0</td></tr><tr><td>20.0</td></tr><tr><td>21.0</td></tr><tr><td>22.0</td></tr><tr><td>23.0</td></tr><tr><td>24.0</td></tr><tr><td>25.0</td></tr><tr><td>26.0</td></tr><tr><td>27.0</td></tr><tr><td>28.0</td></tr><tr><td>29.0</td></tr><tr><td>30.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (31,)</small><table border="1" class="dataframe"><thead><tr><th>PhysHlth</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr><tr><td>6.0</td></tr><tr><td>7.0</td></tr><tr><td>8.0</td></tr><tr><td>9.0</td></tr><tr><td>10.0</td></tr><tr><td>11.0</td></tr><tr><td>&hellip;</td></tr><tr><td>19.0</td></tr><tr><td>20.0</td></tr><tr><td>21.0</td></tr><tr><td>22.0</td></tr><tr><td>23.0</td></tr><tr><td>24.0</td></tr><tr><td>25.0</td></tr><tr><td>26.0</td></tr><tr><td>27.0</td></tr><tr><td>28.0</td></tr><tr><td>29.0</td></tr><tr><td>30.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>DiffWalk</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>Sex</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>1.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (13,)</small><table border="1" class="dataframe"><thead><tr><th>Age</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr><tr><td>6.0</td></tr><tr><td>7.0</td></tr><tr><td>8.0</td></tr><tr><td>9.0</td></tr><tr><td>10.0</td></tr><tr><td>11.0</td></tr><tr><td>12.0</td></tr><tr><td>13.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6,)</small><table border="1" class="dataframe"><thead><tr><th>Education</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr><tr><td>6.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8,)</small><table border="1" class="dataframe"><thead><tr><th>Income</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>1.0</td></tr><tr><td>2.0</td></tr><tr><td>3.0</td></tr><tr><td>4.0</td></tr><tr><td>5.0</td></tr><tr><td>6.0</td></tr><tr><td>7.0</td></tr><tr><td>8.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="standard-encoding">
<h3><strong>Standard encoding</strong><a class="headerlink" href="#standard-encoding" title="Link to this heading">#</a></h3>
<p>We will apply standard encoding on the categorical variables.</p>
<p>The variables to apply standard encoding are the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_to_std_encoding</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GenHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_to_std_encoding</span> <span class="p">:</span>

    <span class="n">X_std_encoding</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">mental_df</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">mental_df</span> <span class="o">=</span> <span class="n">mental_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X_std_encoding</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mental_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 22)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th><th>HighBP</th><th>HighChol</th><th>CholCheck</th><th>BMI</th><th>Smoker</th><th>Stroke</th><th>HeartDiseaseorAttack</th><th>PhysActivity</th><th>Fruits</th><th>Veggies</th><th>HvyAlcoholConsump</th><th>AnyHealthcare</th><th>NoDocbcCost</th><th>GenHlth</th><th>MentHlth</th><th>PhysHlth</th><th>DiffWalk</th><th>Sex</th><th>Age</th><th>Education</th><th>Income</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i32</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i32</td><td>i32</td><td>i32</td></tr></thead><tbody><tr><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>26.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>2</td><td>5.0</td><td>30.0</td><td>0.0</td><td>1.0</td><td>3</td><td>5</td><td>7</td></tr><tr><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>26.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>11</td><td>5</td><td>7</td></tr><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>26.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0</td><td>0.0</td><td>10.0</td><td>0.0</td><td>1.0</td><td>12</td><td>5</td><td>7</td></tr><tr><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>28.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>2</td><td>0.0</td><td>3.0</td><td>0.0</td><td>1.0</td><td>10</td><td>5</td><td>7</td></tr><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>29.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>7</td><td>4</td><td>7</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="changing-data-types">
<h3><strong>Changing  data types</strong><a class="headerlink" href="#changing-data-types" title="Link to this heading">#</a></h3>
<p>We will change the <code class="docutils literal notranslate"><span class="pre">Polars</span></code> data type of some columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">len_unique</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">columns_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mental_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_df</span> <span class="p">:</span>
    <span class="n">len_unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mental_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="n">len_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">len_unique</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary_columns</span> <span class="o">=</span> <span class="n">columns_df</span><span class="p">[</span><span class="n">len_unique</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">multi_columns</span> <span class="o">=</span> <span class="n">columns_df</span><span class="p">[(</span><span class="n">len_unique</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">len_unique</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="n">binary_columns</span> <span class="o">+</span> <span class="n">multi_columns</span>
<span class="n">quant_columns</span> <span class="o">=</span> <span class="n">columns_df</span><span class="p">[</span><span class="n">len_unique</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_to_int</span> <span class="o">=</span> <span class="n">binary_columns</span> <span class="o">+</span> <span class="n">multi_columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_to_int</span> <span class="p">:</span>
    <span class="n">mental_df</span> <span class="o">=</span> <span class="n">change_type</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">mental_df</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">new_type</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mental_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 22)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th><th>HighBP</th><th>HighChol</th><th>CholCheck</th><th>BMI</th><th>Smoker</th><th>Stroke</th><th>HeartDiseaseorAttack</th><th>PhysActivity</th><th>Fruits</th><th>Veggies</th><th>HvyAlcoholConsump</th><th>AnyHealthcare</th><th>NoDocbcCost</th><th>GenHlth</th><th>MentHlth</th><th>PhysHlth</th><th>DiffWalk</th><th>Sex</th><th>Age</th><th>Education</th><th>Income</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>0</td><td>1</td><td>0</td><td>1</td><td>26.0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>2</td><td>5.0</td><td>30.0</td><td>0</td><td>1</td><td>3</td><td>5</td><td>7</td></tr><tr><td>0</td><td>1</td><td>1</td><td>1</td><td>26.0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>2</td><td>0.0</td><td>0.0</td><td>0</td><td>1</td><td>11</td><td>5</td><td>7</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>26.0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0.0</td><td>10.0</td><td>0</td><td>1</td><td>12</td><td>5</td><td>7</td></tr><tr><td>0</td><td>1</td><td>1</td><td>1</td><td>28.0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td>2</td><td>0.0</td><td>3.0</td><td>0</td><td>1</td><td>10</td><td>5</td><td>7</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>29.0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0.0</td><td>0.0</td><td>0</td><td>0</td><td>7</td><td>4</td><td>7</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="missing-values">
<h3><strong>Missing values</strong><a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<p>We check if there are missing values (null/NaN) in our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count_col_nulls</span><span class="p">(</span><span class="n">mental_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 22)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th><th>HighBP</th><th>HighChol</th><th>CholCheck</th><th>BMI</th><th>Smoker</th><th>Stroke</th><th>HeartDiseaseorAttack</th><th>PhysActivity</th><th>Fruits</th><th>Veggies</th><th>HvyAlcoholConsump</th><th>AnyHealthcare</th><th>NoDocbcCost</th><th>GenHlth</th><th>MentHlth</th><th>PhysHlth</th><th>DiffWalk</th><th>Sex</th><th>Age</th><th>Education</th><th>Income</th></tr><tr><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table></div></div></div>
</div>
</section>
</section>
<section id="train-test-split">
<h2><strong>Train-Test Split</strong><a class="headerlink" href="#train-test-split" title="Link to this heading">#</a></h2>
<p>We perform a train-test split. Along the most part of the project we will only use the train part, since it plays the role of the data that we have in reality, and the test partition only should be used to estimate the predictive performance of the model with “new” data (estimation of future performance).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;MentHlth&#39;</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mental_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">mental_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">mental_df</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">X_Y_train_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">X_Y_test_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X_test</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h2><strong>EDA</strong><a class="headerlink" href="#eda" title="Link to this heading">#</a></h2>
<p>In this section we are going to complement this predictive modeling project with  an exploratory data analysis.</p>
<p>We are going to carry out an exploratory data analysis (EDA) only on training data, just because testing data plays the role of data that we really don’t have on reality and only can be used to test models, no to extract any information that could be used to define some aspects of our predictive modeling process.</p>
<section id="descriptive-summary">
<h3><strong>Descriptive summary</strong><a class="headerlink" href="#descriptive-summary" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span><span class="p">,</span> <span class="n">cat_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">auto_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">quant_col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">,</span>
                                     <span class="n">cat_col_names</span><span class="o">=</span><span class="n">cat_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BMI</th>
      <th>MentHlth</th>
      <th>PhysHlth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>79</td>
      <td>31</td>
      <td>31</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>29.865249</td>
      <td>3.751132</td>
      <td>5.819679</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.120358</td>
      <td>8.155693</td>
      <td>10.065874</td>
    </tr>
    <tr>
      <th>min</th>
      <td>12.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Q10</th>
      <td>22.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Q25</th>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>median</th>
      <td>29.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Q75</th>
      <td>33.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Q90</th>
      <td>39.0</td>
      <td>15.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>98.0</td>
      <td>30.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>9.923542</td>
      <td>7.500723</td>
      <td>4.165429</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>1.692153</td>
      <td>2.389862</td>
      <td>1.652748</td>
    </tr>
    <tr>
      <th>n_outliers</th>
      <td>1571</td>
      <td>8279</td>
      <td>7460</td>
    </tr>
    <tr>
      <th>n_not_outliers</th>
      <td>47913</td>
      <td>41205</td>
      <td>42024</td>
    </tr>
    <tr>
      <th>prop_outliers</th>
      <td>0.031748</td>
      <td>0.167307</td>
      <td>0.150756</td>
    </tr>
    <tr>
      <th>prop_not_outliers</th>
      <td>0.968252</td>
      <td>0.832693</td>
      <td>0.849244</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Diabetes</th>
      <th>HighBP</th>
      <th>HighChol</th>
      <th>CholCheck</th>
      <th>Smoker</th>
      <th>Stroke</th>
      <th>HeartDiseaseorAttack</th>
      <th>PhysActivity</th>
      <th>Fruits</th>
      <th>Veggies</th>
      <th>HvyAlcoholConsump</th>
      <th>AnyHealthcare</th>
      <th>NoDocbcCost</th>
      <th>DiffWalk</th>
      <th>Sex</th>
      <th>GenHlth</th>
      <th>Age</th>
      <th>Education</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>5</td>
      <td>13</td>
      <td>6</td>
      <td>8</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mode</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>9</td>
      <td>5</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="outliers">
<h3><strong>Outliers</strong><a class="headerlink" href="#outliers" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers_table</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 7)</small><table border="1" class="dataframe"><thead><tr><th>quant_variables</th><th>lower_bound</th><th>upper_bound</th><th>n_outliers</th><th>n_not_outliers</th><th>prop_outliers</th><th>prop_not_outliers</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;BMI&quot;</td><td>13.0</td><td>45.0</td><td>1571</td><td>47913</td><td>0.031748</td><td>0.968252</td></tr><tr><td>&quot;MentHlth&quot;</td><td>-3.0</td><td>5.0</td><td>8279</td><td>41205</td><td>0.167307</td><td>0.832693</td></tr><tr><td>&quot;PhysHlth&quot;</td><td>-9.0</td><td>15.0</td><td>7460</td><td>42024</td><td>0.150756</td><td>0.849244</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_Y_train_df_trimmed</span> <span class="o">=</span> <span class="n">outlier_filter</span><span class="p">(</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;MentHlth&#39;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">X_Y_train_df_trimmed</span> <span class="o">=</span> <span class="n">outlier_filter</span><span class="p">(</span><span class="n">X_Y_train_df_trimmed</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_Y_train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(49484, 22)
</pre></div>
</div>
</div>
</div>
</section>
<section id="response-analysis">
<h3><strong>Response analysis</strong><a class="headerlink" href="#response-analysis" title="Link to this heading">#</a></h3>
<section id="histogram">
<h4><strong>Histogram</strong><a class="headerlink" href="#histogram" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a2da855a7ecad8ffd5ae2e9d353639be5d4f9c9baf41b93a07d17b4701bfbd49.png" src="_images/a2da855a7ecad8ffd5ae2e9d353639be5d4f9c9baf41b93a07d17b4701bfbd49.png" />
</div>
</div>
</section>
<section id="frequencies">
<h4><strong>Frequencies</strong><a class="headerlink" href="#frequencies" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_cat</span> <span class="o">=</span> <span class="n">quant_to_cat</span><span class="p">(</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq_table</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">response_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 5)</small><table border="1" class="dataframe"><thead><tr><th>MentHlth: unique values</th><th>abs_freq</th><th>rel_freq</th><th>cum_abs_freq</th><th>cum_rel_freq</th></tr><tr><td>object</td><td>i64</td><td>f64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>(-inf, 0]</td><td>33656</td><td>0.6801</td><td>33656</td><td>0.680139</td></tr><tr><td>(0, 2]</td><td>3745</td><td>0.0757</td><td>37401</td><td>0.75582</td></tr><tr><td>(2, 15]</td><td>7693</td><td>0.1555</td><td>45094</td><td>0.911284</td></tr><tr><td>(15, 30]</td><td>4390</td><td>0.0887</td><td>49484</td><td>1.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="boxplot">
<h4><strong>Boxplot</strong><a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">statistics</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/74dc996cb90755666290ec7a6a4beae8cb3965b119e8e276bc7528fcdeee1a5c.png" src="_images/74dc996cb90755666290ec7a6a4beae8cb3965b119e8e276bc7528fcdeee1a5c.png" />
</div>
</div>
</section>
<section id="ecdf-plot">
<h4><strong>ECDF-plot</strong><a class="headerlink" href="#ecdf-plot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdfplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="s1">&#39;MentHlth&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2b62c97c65b5ddecec662d1568ff62cf23e323e1dc32d01cbfe1f10db57eec3b.png" src="_images/2b62c97c65b5ddecec662d1568ff62cf23e323e1dc32d01cbfe1f10db57eec3b.png" />
</div>
</div>
</section>
</section>
<section id="relation-between-response-and-predictors">
<h3><strong>Relation between response and predictors</strong><a class="headerlink" href="#relation-between-response-and-predictors" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">quant_columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
<span class="n">cat_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">binary_columns</span> <span class="o">+</span> <span class="n">multi_columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MentHlth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BMI</th>
      <td>0.10</td>
    </tr>
    <tr>
      <th>PhysHlth</th>
      <td>0.38</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Quantitative predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/674079d8b8b25b5af703b5f7e82f06f929e32fb4fe3bff375b72581008e5eff1.png" src="_images/674079d8b8b25b5af703b5f7e82f06f929e32fb4fe3bff375b72581008e5eff1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.91</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">statistics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">lines_width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> 
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color_stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d8e2b5ac4908b5891de6fabc7b362b9dc41c2dbed10f5a3221078a7a1b4668fe.png" src="_images/d8e2b5ac4908b5891de6fabc7b362b9dc41c2dbed10f5a3221078a7a1b4668fe.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.91</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5ca4eca33d8c8d76b6106d4f90178b4e48872d3d8e02b57fad97cb6083af2534.png" src="_images/5ca4eca33d8c8d76b6106d4f90178b4e48872d3d8e02b57fad97cb6083af2534.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stripplot_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">statistics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">lines_width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> 
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e87e5dc15054fe613ee46b2db549865df13f5a1d4759a3ce6c3789febd13d233.png" src="_images/e87e5dc15054fe613ee46b2db549865df13f5a1d4759a3ce6c3789febd13d233.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.91</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                 <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transparency</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01f9da8effe54d7240be2b5f6e8ec4821a91149ebe3d9189c80a211d57f63f4e.png" src="_images/01f9da8effe54d7240be2b5f6e8ec4821a91149ebe3d9189c80a211d57f63f4e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdf_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Mental Health vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_xticks</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.91</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                 <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transparency</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ca6daf0e8a1e7ee33599b206031efa12b6428f23bd970b5d7c91c7679533bae2.png" src="_images/ca6daf0e8a1e7ee33599b206031efa12b6428f23bd970b5d7c91c7679533bae2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_predictors</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">cross_quant_cat_summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">quant_col</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">cat_col</span><span class="o">=</span><span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Diabetes</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.037</td><td>7.209</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>7.05</td><td>2.815</td><td>0.136506</td><td>0.0</td></tr><tr><td>1.0</td><td>4.46</td><td>8.941</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>20.0</td><td>30.0</td><td>2.881</td><td>2.066</td><td>0.181734</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>HighBP</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.157</td><td>7.382</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>6.595</td><td>2.747</td><td>0.141036</td><td>0.0</td></tr><tr><td>1.0</td><td>4.21</td><td>8.679</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>20.0</td><td>30.0</td><td>3.355</td><td>2.166</td><td>0.17203</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>HighChol</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>2.984</td><td>7.178</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>7.183</td><td>2.837</td><td>0.136073</td><td>0.0</td></tr><tr><td>1.0</td><td>4.442</td><td>8.889</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>20.0</td><td>30.0</td><td>2.957</td><td>2.082</td><td>0.180473</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>CholCheck</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>4.443</td><td>8.859</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>20.0</td><td>30.0</td><td>3.044</td><td>2.107</td><td>0.141827</td><td>0.0</td></tr><tr><td>1.0</td><td>3.733</td><td>8.136</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>4.546</td><td>2.398</td><td>0.166763</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Smoker</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.042</td><td>7.223</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>7.01</td><td>2.809</td><td>0.13727</td><td>0.0</td></tr><tr><td>1.0</td><td>4.528</td><td>9.005</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>20.0</td><td>30.0</td><td>2.763</td><td>2.04</td><td>0.183455</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Stroke</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.561</td><td>7.925</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>5.053</td><td>2.489</td><td>0.159565</td><td>0.0</td></tr><tr><td>1.0</td><td>6.604</td><td>10.658</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>10.0</td><td>30.0</td><td>30.0</td><td>0.366</td><td>1.407</td><td>0.134024</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>HeartDiseaseorAttack</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.498</td><td>7.831</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>5.261</td><td>2.524</td><td>0.157237</td><td>0.0</td></tr><tr><td>1.0</td><td>5.212</td><td>9.692</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>28.0</td><td>30.0</td><td>1.71</td><td>1.797</td><td>0.174508</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>PhysActivity</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>5.404</td><td>9.73</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>28.0</td><td>30.0</td><td>1.521</td><td>1.736</td><td>0.180731</td><td>0.0</td></tr><tr><td>1.0</td><td>3.051</td><td>7.277</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>6.919</td><td>2.801</td><td>0.13634</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Fruits</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>4.365</td><td>8.75</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>20.0</td><td>30.0</td><td>3.131</td><td>2.112</td><td>0.178547</td><td>0.0</td></tr><tr><td>1.0</td><td>3.361</td><td>7.729</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>5.67</td><td>2.602</td><td>0.149549</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Veggies</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>4.575</td><td>9.028</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>20.0</td><td>30.0</td><td>2.7</td><td>2.025</td><td>0.151454</td><td>0.0</td></tr><tr><td>1.0</td><td>3.53</td><td>7.89</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>5.151</td><td>2.507</td><td>0.157876</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>HvyAlcoholConsump</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.734</td><td>8.151</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>4.532</td><td>2.397</td><td>0.166258</td><td>0.0</td></tr><tr><td>1.0</td><td>4.132</td><td>8.25</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>15.0</td><td>30.0</td><td>3.863</td><td>2.239</td><td>0.128745</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>AnyHealthcare</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>5.554</td><td>9.831</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>30.0</td><td>30.0</td><td>1.392</td><td>1.704</td><td>0.183432</td><td>0.0</td></tr><tr><td>1.0</td><td>3.667</td><td>8.06</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>4.73</td><td>2.432</td><td>0.163554</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>NoDocbcCost</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>3.242</td><td>7.579</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>14.0</td><td>30.0</td><td>6.07</td><td>2.669</td><td>0.144869</td><td>0.0</td></tr><tr><td>1.0</td><td>8.704</td><td>11.302</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>30.0</td><td>-0.605</td><td>1.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>DiffWalk</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>2.563</td><td>6.612</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>8.0</td><td>30.0</td><td>9.393</td><td>3.162</td><td>0.188504</td><td>0.0</td></tr><tr><td>1.0</td><td>7.281</td><td>10.844</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>11.0</td><td>30.0</td><td>30.0</td><td>0.002</td><td>1.263</td><td>0.141</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>Sex</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>4.394</td><td>8.654</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>20.0</td><td>30.0</td><td>3.221</td><td>2.123</td><td>0.1412</td><td>0.0</td></tr><tr><td>1.0</td><td>2.986</td><td>7.448</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>10.0</td><td>30.0</td><td>6.773</td><td>2.802</td><td>0.192626</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 14)</small><table border="1" class="dataframe"><thead><tr><th>GenHlth</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>1.394</td><td>4.783</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>30.0</td><td>22.862</td><td>4.677</td><td>0.183865</td><td>0.0</td></tr><tr><td>1.0</td><td>1.841</td><td>5.342</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>30.0</td><td>16.18</td><td>3.959</td><td>0.107473</td><td>0.0</td></tr><tr><td>2.0</td><td>2.848</td><td>6.899</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>8.0</td><td>2.948</td><td>0.0</td><td>0.0</td></tr><tr><td>3.0</td><td>6.208</td><td>9.977</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>10.0</td><td>30.0</td><td>30.0</td><td>0.838</td><td>1.516</td><td>0.244682</td><td>0.0</td></tr><tr><td>4.0</td><td>11.673</td><td>12.618</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>30.0</td><td>30.0</td><td>30.0</td><td>-1.482</td><td>0.496</td><td>0.131618</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (13, 14)</small><table border="1" class="dataframe"><thead><tr><th>Age</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>4.935</td><td>8.242</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.5</td><td>5.0</td><td>19.0</td><td>30.0</td><td>2.836</td><td>1.958</td><td>0.146802</td><td>0.0</td></tr><tr><td>1.0</td><td>4.086</td><td>7.901</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>15.0</td><td>30.0</td><td>4.339</td><td>2.302</td><td>0.166224</td><td>0.0</td></tr><tr><td>2.0</td><td>4.065</td><td>7.92</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>15.0</td><td>30.0</td><td>4.308</td><td>2.295</td><td>0.208619</td><td>0.0</td></tr><tr><td>3.0</td><td>4.185</td><td>8.231</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>15.0</td><td>30.0</td><td>3.937</td><td>2.249</td><td>0.132995</td><td>0.0</td></tr><tr><td>4.0</td><td>4.59</td><td>8.67</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>20.0</td><td>30.0</td><td>3.071</td><td>2.08</td><td>0.158975</td><td>0.0</td></tr><tr><td>5.0</td><td>5.008</td><td>9.206</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>20.0</td><td>30.0</td><td>2.172</td><td>1.886</td><td>0.227507</td><td>0.0</td></tr><tr><td>6.0</td><td>4.925</td><td>9.207</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>20.0</td><td>30.0</td><td>2.258</td><td>1.915</td><td>0.127569</td><td>0.0</td></tr><tr><td>7.0</td><td>5.052</td><td>9.347</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>24.0</td><td>30.0</td><td>2.013</td><td>1.856</td><td>0.163528</td><td>0.0</td></tr><tr><td>8.0</td><td>4.002</td><td>8.455</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>15.0</td><td>30.0</td><td>3.871</td><td>2.272</td><td>0.207775</td><td>0.0</td></tr><tr><td>9.0</td><td>3.158</td><td>7.612</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>10.0</td><td>30.0</td><td>6.241</td><td>2.711</td><td>0.142283</td><td>0.0</td></tr><tr><td>10.0</td><td>2.495</td><td>6.808</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>8.0</td><td>30.0</td><td>9.223</td><td>3.173</td><td>0.161602</td><td>0.0</td></tr><tr><td>11.0</td><td>2.357</td><td>6.688</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>6.0</td><td>30.0</td><td>9.992</td><td>3.292</td><td>0.184543</td><td>0.0</td></tr><tr><td>12.0</td><td>1.915</td><td>5.945</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>30.0</td><td>13.719</td><td>3.758</td><td>0.126042</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 14)</small><table border="1" class="dataframe"><thead><tr><th>Education</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>6.291</td><td>10.544</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>10.0</td><td>30.0</td><td>30.0</td><td>0.595</td><td>1.474</td><td>0.170404</td><td>0.0</td></tr><tr><td>1.0</td><td>6.124</td><td>10.482</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>7.0</td><td>30.0</td><td>30.0</td><td>0.653</td><td>1.506</td><td>0.15</td><td>0.0</td></tr><tr><td>2.0</td><td>5.858</td><td>10.135</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>7.0</td><td>30.0</td><td>30.0</td><td>1.002</td><td>1.596</td><td>0.11936</td><td>0.0</td></tr><tr><td>3.0</td><td>4.15</td><td>8.589</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>16.0</td><td>30.0</td><td>3.501</td><td>2.191</td><td>0.127273</td><td>0.0</td></tr><tr><td>4.0</td><td>4.15</td><td>8.55</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>3.0</td><td>17.0</td><td>30.0</td><td>3.53</td><td>2.197</td><td>0.170792</td><td>0.0</td></tr><tr><td>5.0</td><td>2.713</td><td>6.795</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>10.0</td><td>30.0</td><td>8.769</td><td>3.078</td><td>0.16845</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8, 14)</small><table border="1" class="dataframe"><thead><tr><th>Income</th><th>mean_MentHlth</th><th>std_MentHlth</th><th>min_MentHlth</th><th>Q10_MentHlth</th><th>Q25_MentHlth</th><th>median_MentHlth</th><th>Q75_MentHlth</th><th>Q90_MentHlth</th><th>max_price</th><th>kurtosis_MentHlth</th><th>skew_MentHlth</th><th>prop_outliers_MentHlth</th><th>prop_nan_MentHlth</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>8.467</td><td>11.625</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>15.0</td><td>30.0</td><td>30.0</td><td>-0.649</td><td>1.016</td><td>0.14237</td><td>0.0</td></tr><tr><td>1.0</td><td>7.211</td><td>10.886</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>10.0</td><td>30.0</td><td>30.0</td><td>0.005</td><td>1.271</td><td>0.145741</td><td>0.0</td></tr><tr><td>2.0</td><td>5.592</td><td>9.758</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>7.0</td><td>25.0</td><td>30.0</td><td>1.312</td><td>1.67</td><td>0.199752</td><td>0.0</td></tr><tr><td>3.0</td><td>4.787</td><td>9.135</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>5.0</td><td>20.0</td><td>30.0</td><td>2.42</td><td>1.952</td><td>0.143312</td><td>0.0</td></tr><tr><td>4.0</td><td>3.779</td><td>8.147</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>15.0</td><td>30.0</td><td>4.46</td><td>2.376</td><td>0.170311</td><td>0.0</td></tr><tr><td>5.0</td><td>3.259</td><td>7.574</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>2.0</td><td>14.0</td><td>30.0</td><td>6.098</td><td>2.669</td><td>0.168709</td><td>0.0</td></tr><tr><td>6.0</td><td>2.691</td><td>6.759</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>10.0</td><td>30.0</td><td>8.817</td><td>3.081</td><td>0.0</td><td>0.0</td></tr><tr><td>7.0</td><td>2.166</td><td>5.935</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>5.0</td><td>30.0</td><td>12.434</td><td>3.543</td><td>0.15736</td><td>0.0</td></tr></tbody></table></div></div></div>
</div>
</section>
</section>
<section id="poisson-model">
<h2><strong>Poisson Model</strong><a class="headerlink" href="#poisson-model" title="Link to this heading">#</a></h2>
<section id="why-poisson-regression">
<h3><strong>Why Poisson regression?</strong><a class="headerlink" href="#why-poisson-regression" title="Link to this heading">#</a></h3>
<p>Linear regression is not suitable for counting data because of several reasons, some of them are the following:</p>
<ol class="arabic simple">
<li><p>It can lead into negative predictions (negative counts)</p></li>
<li><p>The response is often not distributed as a Normal.</p></li>
<li><p>The variance of the error is often not constant (depend on the mean).</p></li>
<li><p>Is difficult to use transformations when there are zeros in the response variable.</p></li>
</ol>
</section>
<section id="assumptions">
<h3><strong>Assumptions</strong><a class="headerlink" href="#assumptions" title="Link to this heading">#</a></h3>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have a <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<ul>
<li><p>The basic assumption is that the response follows a Poisson distribution:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathcal{Y}\sim Poisson(\mu), \quad \mu&gt;0\)</span></p></li>
</ul>
<p>Therefore:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P(\mathcal{Y} = y) = \dfrac{e^{-\mu}\cdot \mu^y}{y!}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(E[\mathcal{Y}] = Var(\mathcal{Y}) = \mu\)</span></p></li>
</ul>
</li>
</ul>
<ul>
<li><p>The model is defined as follows:</p>
<div class="math notranslate nohighlight">
\[\mu_i = e^{\beta_0 + x_{i}^{\prime} \cdot \beta} = e^{\eta_i}, \quad \small{i=1,\dots,n}\]</div>
</li>
<li><p>Taking the natural logarithm we have the following:</p>
<div class="math notranslate nohighlight">
\[log(\mu_i) = \eta_i = \beta_0 +  x_{i}^{\prime} \cdot \beta, \quad \small{i=1,\dots,n}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu_i = E[\mathcal{Y} | \mathcal{X}=x_i]\hspace{0.05cm} = \text{the mean of the response conditioned to the value of the predictors.}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_i = (x_{i1},\dots, x_{ip})^\prime \in \mathbb{R}^p\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\beta = (\beta_1, \dots, \beta_p)^\prime  \in \mathbb{R}^p\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="estimation">
<h3><strong>Estimation</strong><a class="headerlink" href="#estimation" title="Link to this heading">#</a></h3>
<p>Parameters <span class="math notranslate nohighlight">\((\beta_0, \beta)\)</span> are estimated by Maximum Likelihood, we are not going to go deeper into  details at this point, because the optimization problem has no exact solution, and, therefore, it’s a little advanced and  out of the scope of this project.</p>
<p>Anyway, once the parameters are estimated we have  <span class="math notranslate nohighlight">\((\widehat{\beta}_0, \widehat{\beta})\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm}\Rightarrow\hspace{0.15cm}\)</span> <span class="math notranslate nohighlight">\(\widehat{\mu}_i = e^{\widehat{\beta}_0 + x_{i}^{\prime} \cdot \widehat{\beta}}\)</span></p>
<p>We can estimate a Poisson regression model in <code class="docutils literal notranslate"><span class="pre">Python</span></code> using <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, a fantastic library to implement statistical models.</p>
<p>The following code is a class to perform Poisson regression using <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation but  with the possibility of including categorical predictors as dummy variables and interactions between the predictors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">poisson_model</span> <span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>

    <span class="k">def</span> <span class="nf">dummies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">):</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">transform_to_dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cols_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">):</span>

        <span class="n">X_inter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">interactions_to_add</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="c1"># X without any changes</span>
            <span class="n">interactions_to_add</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
                                   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> 
                                   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X_initial</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">unique</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="k">for</span> <span class="n">quant</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">interactions_to_add</span><span class="p">:</span>
            <span class="n">X_inter</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">quant</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">X_inter</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_to_add</span> <span class="o">=</span> <span class="n">interactions_to_add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>

        <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_modified</span> <span class="o">=</span> <span class="n">X</span>

        <span class="n">poisson</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GeneralizedPoisson</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poisson_fit</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span>
        <span class="n">interactions_to_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_to_add</span>

        <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        
        <span class="n">Y_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Y_hat</span>
</pre></div>
</div>
</div>
</div>
<p>Just to see how to use the class and their summary output we are going to train four full linear models. Full in the sense that hey will include all the available predictors, but we will distinguish four cases:</p>
<ol class="arabic simple">
<li><p>Full model with dummies for categorical predictors and some interactions</p></li>
<li><p>Full model without dummies but with interactions.</p></li>
<li><p>Full model with dummies but without interactions.</p></li>
<li><p>Full model without dummies and interactions.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statmodels only reads Pandas dataframes, for now.</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">full_model_inter_dummies</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">results_full_model_inter_dummies</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">full_model_inter</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">results_full_model_inter</span> <span class="o">=</span> <span class="n">full_model_inter</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">full_model_dummies</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">full_model_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">results_full_model_dummies</span> <span class="o">=</span> <span class="n">full_model_dummies</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - not interactions - not dummies</span>
<span class="n">full_model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">full_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">results_full_model</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to print the summaries of the respective models just to see how they look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_inter_dummies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    GeneralizedPoisson Regression Results                     
==============================================================================
Dep. Variable:               MentHlth   No. Observations:                49484
Model:             GeneralizedPoisson   Df Residuals:                    49426
Method:                           MLE   Df Model:                           57
Date:                Fri, 29 Dec 2023   Pseudo R-squ.:                 0.06499
Time:                        10:40:16   Log-Likelihood:                -83468.
converged:                      False   LL-Null:                       -89269.
Covariance Type:            nonrobust   LLR p-value:                     0.000
==========================================================================================
                             coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------------
BMI                       -0.0001      0.001     -0.120      0.905      -0.003       0.002
PhysHlth                   0.0374      0.006      6.788      0.000       0.027       0.048
Diabetes_1                -0.0955      0.019     -5.156      0.000      -0.132      -0.059
HighBP_1                  -0.0130      0.019     -0.700      0.484      -0.050       0.023
HighChol_1                 0.2008      0.017     11.677      0.000       0.167       0.234
CholCheck_1               -0.1697      0.045     -3.778      0.000      -0.258      -0.082
Smoker_1                   0.1263      0.016      7.845      0.000       0.095       0.158
Stroke_1                   0.1083      0.029      3.777      0.000       0.052       0.164
HeartDiseaseorAttack_1    -0.0146      0.023     -0.646      0.519      -0.059       0.030
PhysActivity_1             0.0057      0.017      0.330      0.741      -0.028       0.040
Fruits_1                  -0.0661      0.016     -4.085      0.000      -0.098      -0.034
Veggies_1                 -0.0125      0.019     -0.659      0.510      -0.050       0.025
HvyAlcoholConsump_1        0.2989      0.035      8.470      0.000       0.230       0.368
AnyHealthcare_1            0.1594      0.035      4.549      0.000       0.091       0.228
NoDocbcCost_1              0.3739      0.022     17.274      0.000       0.332       0.416
DiffWalk_1                 0.2940      0.021     14.058      0.000       0.253       0.335
Sex_1                     -0.3930      0.069     -5.731      0.000      -0.527      -0.259
GenHlth_1                  0.3998      0.037     10.951      0.000       0.328       0.471
GenHlth_2                  0.5857      0.037     15.772      0.000       0.513       0.658
GenHlth_3                  0.9042      0.043     21.183      0.000       0.821       0.988
GenHlth_4                  1.3923      0.064     21.716      0.000       1.267       1.518
Age_1                     -0.1047      0.075     -1.393      0.164      -0.252       0.043
Age_10                    -1.3411      0.066    -20.371      0.000      -1.470      -1.212
Age_11                    -1.4708      0.069    -21.237      0.000      -1.607      -1.335
Age_12                    -1.6690      0.071    -23.632      0.000      -1.807      -1.531
Age_2                     -0.2026      0.070     -2.878      0.004      -0.341      -0.065
Age_3                     -0.2249      0.067     -3.355      0.001      -0.356      -0.093
Age_4                     -0.2467      0.065     -3.783      0.000      -0.375      -0.119
Age_5                     -0.3407      0.064     -5.353      0.000      -0.465      -0.216
Age_6                     -0.5282      0.063     -8.418      0.000      -0.651      -0.405
Age_7                     -0.5864      0.062     -9.423      0.000      -0.708      -0.464
Age_8                     -0.8351      0.063    -13.349      0.000      -0.958      -0.713
Age_9                     -1.0649      0.063    -16.807      0.000      -1.189      -0.941
Education_1                1.1684      0.106     11.069      0.000       0.962       1.375
Education_2                1.1473      0.100     11.426      0.000       0.951       1.344
Education_3                1.2535      0.097     12.978      0.000       1.064       1.443
Education_4                1.3400      0.097     13.781      0.000       1.149       1.531
Education_5                1.4128      0.098     14.469      0.000       1.221       1.604
Income_1                  -0.0180      0.058     -0.310      0.756      -0.131       0.095
Income_2                  -0.1213      0.056     -2.177      0.029      -0.231      -0.012
Income_3                  -0.1512      0.054     -2.811      0.005      -0.257      -0.046
Income_4                  -0.1577      0.052     -3.019      0.003      -0.260      -0.055
Income_5                  -0.2508      0.051     -4.905      0.000      -0.351      -0.151
Income_6                  -0.2562      0.051     -5.063      0.000      -0.355      -0.157
Income_7                  -0.3680      0.049     -7.462      0.000      -0.465      -0.271
BMI:Sex_1                 -0.0036      0.002     -1.626      0.104      -0.008       0.001
PhysHlth:Sex_1             0.0060      0.001      4.613      0.000       0.003       0.008
PhysHlth:GenHlth_1        -0.0054      0.006     -0.940      0.347      -0.017       0.006
PhysHlth:GenHlth_2        -0.0074      0.005     -1.390      0.164      -0.018       0.003
PhysHlth:GenHlth_3        -0.0098      0.005     -1.853      0.064      -0.020       0.001
PhysHlth:GenHlth_4        -0.0218      0.006     -3.947      0.000      -0.033      -0.011
PhysHlth:Income_1         -0.0007      0.003     -0.271      0.786      -0.006       0.005
PhysHlth:Income_2         -0.0007      0.003     -0.237      0.812      -0.006       0.005
PhysHlth:Income_3          0.0020      0.003      0.752      0.452      -0.003       0.007
PhysHlth:Income_4         -0.0052      0.003     -1.898      0.058      -0.010       0.000
PhysHlth:Income_5          0.0014      0.003      0.533      0.594      -0.004       0.007
PhysHlth:Income_6         -0.0044      0.003     -1.593      0.111      -0.010       0.001
PhysHlth:Income_7         -0.0019      0.003     -0.698      0.485      -0.007       0.003
alpha                      5.8027      0.105     55.122      0.000       5.596       6.009
==========================================================================================
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_inter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    GeneralizedPoisson Regression Results                     
==============================================================================
Dep. Variable:               MentHlth   No. Observations:                49484
Model:             GeneralizedPoisson   Df Residuals:                    49459
Method:                           MLE   Df Model:                           24
Date:                Fri, 29 Dec 2023   Pseudo R-squ.:                 0.06248
Time:                        10:40:18   Log-Likelihood:                -83691.
converged:                      False   LL-Null:                       -89269.
Covariance Type:            nonrobust   LLR p-value:                     0.000
========================================================================================
                           coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Diabetes                -0.1198      0.018     -6.500      0.000      -0.156      -0.084
HighBP                  -0.0231      0.019     -1.237      0.216      -0.060       0.014
HighChol                 0.2309      0.017     13.333      0.000       0.197       0.265
CholCheck                0.2816      0.047      5.951      0.000       0.189       0.374
BMI                      0.0079      0.001      7.404      0.000       0.006       0.010
Smoker                   0.1597      0.016      9.996      0.000       0.128       0.191
Stroke                   0.1078      0.029      3.751      0.000       0.051       0.164
HeartDiseaseorAttack    -0.0390      0.023     -1.726      0.084      -0.083       0.005
PhysActivity             0.0417      0.017      2.412      0.016       0.008       0.076
Fruits                  -0.0602      0.016     -3.705      0.000      -0.092      -0.028
Veggies                  0.0122      0.019      0.637      0.524      -0.025       0.050
HvyAlcoholConsump        0.3128      0.035      8.844      0.000       0.244       0.382
AnyHealthcare            0.2999      0.037      8.158      0.000       0.228       0.372
NoDocbcCost              0.4703      0.021     22.330      0.000       0.429       0.512
GenHlth                  0.3599      0.011     31.460      0.000       0.338       0.382
PhysHlth                 0.0475      0.003     18.905      0.000       0.043       0.052
DiffWalk                 0.2884      0.021     13.864      0.000       0.248       0.329
Sex                     -0.1868      0.067     -2.792      0.005      -0.318      -0.056
Age                     -0.1430      0.003    -47.593      0.000      -0.149      -0.137
Education                0.1125      0.008     13.727      0.000       0.096       0.129
Income                  -0.0225      0.005     -4.255      0.000      -0.033      -0.012
BMI:Sex                 -0.0100      0.002     -4.689      0.000      -0.014      -0.006
PhysHlth:Sex             0.0071      0.001      5.477      0.000       0.005       0.010
PhysHlth:GenHlth        -0.0059      0.001     -8.822      0.000      -0.007      -0.005
PhysHlth:Income         -0.0018      0.000     -6.375      0.000      -0.002      -0.001
alpha                    5.6158      0.096     58.286      0.000       5.427       5.805
========================================================================================
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_dummies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    GeneralizedPoisson Regression Results                     
==============================================================================
Dep. Variable:               MentHlth   No. Observations:                49484
Model:             GeneralizedPoisson   Df Residuals:                    49439
Method:                           MLE   Df Model:                           44
Date:                Fri, 29 Dec 2023   Pseudo R-squ.:                 0.06463
Time:                        10:40:23   Log-Likelihood:                -83499.
converged:                      False   LL-Null:                       -89269.
Covariance Type:            nonrobust   LLR p-value:                     0.000
==========================================================================================
                             coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------------
BMI                       -0.0018      0.001     -1.682      0.093      -0.004       0.000
PhysHlth                   0.0276      0.001     32.348      0.000       0.026       0.029
Diabetes_1                -0.0979      0.019     -5.288      0.000      -0.134      -0.062
HighBP_1                  -0.0149      0.019     -0.798      0.425      -0.051       0.022
HighChol_1                 0.2081      0.017     12.086      0.000       0.174       0.242
CholCheck_1               -0.1113      0.046     -2.415      0.016      -0.202      -0.021
Smoker_1                   0.1253      0.016      7.789      0.000       0.094       0.157
Stroke_1                   0.0997      0.029      3.472      0.001       0.043       0.156
HeartDiseaseorAttack_1    -0.0103      0.023     -0.455      0.649      -0.055       0.034
PhysActivity_1             0.0062      0.017      0.360      0.719      -0.028       0.040
Fruits_1                  -0.0662      0.016     -4.091      0.000      -0.098      -0.035
Veggies_1                 -0.0206      0.019     -1.085      0.278      -0.058       0.017
HvyAlcoholConsump_1        0.2941      0.035      8.317      0.000       0.225       0.363
AnyHealthcare_1            0.1590      0.035      4.560      0.000       0.091       0.227
NoDocbcCost_1              0.3907      0.022     18.135      0.000       0.348       0.433
DiffWalk_1                 0.2888      0.021     13.772      0.000       0.248       0.330
Sex_1                     -0.4382      0.017    -26.384      0.000      -0.471      -0.406
GenHlth_1                  0.3922      0.035     11.250      0.000       0.324       0.461
GenHlth_2                  0.5818      0.035     16.587      0.000       0.513       0.651
GenHlth_3                  0.8998      0.038     23.450      0.000       0.825       0.975
GenHlth_4                  1.0876      0.044     24.606      0.000       1.001       1.174
Age_1                     -0.0868      0.074     -1.165      0.244      -0.233       0.059
Age_10                    -1.3367      0.065    -20.440      0.000      -1.465      -1.208
Age_11                    -1.4753      0.069    -21.421      0.000      -1.610      -1.340
Age_12                    -1.6699      0.070    -23.781      0.000      -1.808      -1.532
Age_2                     -0.1825      0.070     -2.616      0.009      -0.319      -0.046
Age_3                     -0.2328      0.067     -3.493      0.000      -0.363      -0.102
Age_4                     -0.2641      0.065     -4.070      0.000      -0.391      -0.137
Age_5                     -0.3596      0.063     -5.684      0.000      -0.484      -0.236
Age_6                     -0.5358      0.062     -8.598      0.000      -0.658      -0.414
Age_7                     -0.5861      0.062     -9.490      0.000      -0.707      -0.465
Age_8                     -0.8358      0.062    -13.453      0.000      -0.958      -0.714
Age_9                     -1.0713      0.063    -17.013      0.000      -1.195      -0.948
Education_1                1.1890      0.099     11.979      0.000       0.994       1.384
Education_2                1.1923      0.094     12.659      0.000       1.008       1.377
Education_3                1.2494      0.090     13.832      0.000       1.072       1.426
Education_4                1.3370      0.091     14.702      0.000       1.159       1.515
Education_5                1.4095      0.091     15.422      0.000       1.230       1.589
Income_1                  -0.0061      0.036     -0.172      0.863      -0.076       0.064
Income_2                  -0.1015      0.036     -2.830      0.005      -0.172      -0.031
Income_3                  -0.1036      0.035     -2.950      0.003      -0.172      -0.035
Income_4                  -0.1880      0.035     -5.303      0.000      -0.257      -0.118
Income_5                  -0.2267      0.035     -6.473      0.000      -0.295      -0.158
Income_6                  -0.2837      0.035     -8.007      0.000      -0.353      -0.214
Income_7                  -0.3771      0.035    -10.838      0.000      -0.445      -0.309
alpha                      5.8126      0.106     54.898      0.000       5.605       6.020
==========================================================================================
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    GeneralizedPoisson Regression Results                     
==============================================================================
Dep. Variable:               MentHlth   No. Observations:                49484
Model:             GeneralizedPoisson   Df Residuals:                    49463
Method:                           MLE   Df Model:                           20
Date:                Fri, 29 Dec 2023   Pseudo R-squ.:                 0.06172
Time:                        10:40:25   Log-Likelihood:                -83759.
converged:                      False   LL-Null:                       -89269.
Covariance Type:            nonrobust   LLR p-value:                     0.000
========================================================================================
                           coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Diabetes                -0.1179      0.018     -6.389      0.000      -0.154      -0.082
HighBP                  -0.0236      0.019     -1.259      0.208      -0.060       0.013
HighChol                 0.2330      0.017     13.452      0.000       0.199       0.267
CholCheck                0.3972      0.048      8.336      0.000       0.304       0.491
BMI                      0.0066      0.001      6.944      0.000       0.005       0.008
Smoker                   0.1695      0.016     10.615      0.000       0.138       0.201
Stroke                   0.1061      0.029      3.699      0.000       0.050       0.162
HeartDiseaseorAttack    -0.0479      0.023     -2.128      0.033      -0.092      -0.004
PhysActivity             0.0533      0.017      3.073      0.002       0.019       0.087
Fruits                  -0.0602      0.016     -3.703      0.000      -0.092      -0.028
Veggies                  0.0145      0.019      0.750      0.453      -0.023       0.052
HvyAlcoholConsump        0.3172      0.035      8.972      0.000       0.248       0.387
AnyHealthcare            0.3460      0.037      9.280      0.000       0.273       0.419
NoDocbcCost              0.4836      0.021     23.025      0.000       0.442       0.525
GenHlth                  0.3038      0.010     31.502      0.000       0.285       0.323
PhysHlth                 0.0266      0.001     32.010      0.000       0.025       0.028
DiffWalk                 0.2875      0.021     13.734      0.000       0.246       0.328
Sex                     -0.4205      0.017    -25.282      0.000      -0.453      -0.388
Age                     -0.1409      0.003    -46.912      0.000      -0.147      -0.135
Education                0.1173      0.008     14.332      0.000       0.101       0.133
Income                  -0.0434      0.004    -10.566      0.000      -0.051      -0.035
alpha                    5.5775      0.095     58.720      0.000       5.391       5.764
========================================================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="standard-deviation-of-coefficients">
<h3><strong>Standard deviation of coefficients</strong><a class="headerlink" href="#standard-deviation-of-coefficients" title="Link to this heading">#</a></h3>
<p>The precision of beta coefficients estimations is given by the
standard deviation of their estimators:</p>
<div class="math notranslate nohighlight">
\[s_d(\widehat{\beta}_j)\]</div>
<p>In this case we don’t have a close formula for it as in linear regression. It’s estimated through Maximum Likelihood, following the nex three steps:</p>
<ol class="arabic simple">
<li><p>Estimation of Coefficients: The coefficients in Poisson regression are usually estimated using Maximum Likelihood Estimation (MLE).</p></li>
<li><p>Variance-Covariance Matrix: After fitting the model, the covariance matrix of the estimated coefficients can be derived from the inverse of the Fisher Information Matrix. This matrix is often computed as part of the model fitting process in statistical software.</p></li>
<li><p>Standard Errors: The standard errors (which are the square roots of the variances) of the coefficients are the square roots of the diagonal elements of this variance-covariance matrix.</p></li>
</ol>
<p><strong>Why is the variance of the coefficient estimators important?</strong></p>
<p>The standard deviation of a coefficient estimator indicates how much
the estimation of that coefficient varies, in mean, when the model is  trained with many different samples.</p>
<p>Suppose many samples are obtained, and with each of them a linear
regression model is trained. Then, we get many estimations of the model
coefficient <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span>, one with each sample.</p>
<p>Then, <span class="math notranslate nohighlight">\(s_d(\widehat{\beta}_j)\)</span> indicates how much
<span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> varies from one sample to another, in mean.</p>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If the standard deviation is <strong>high</strong>, this indicates that will be obtained
big differences when <span class="math notranslate nohighlight">\(\beta_j\)</span> is estimate with <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span>
depending on the sample that is used for estimate it, that means
estimator <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> is <strong>imprecise</strong>, because it will be much
dispersion of the values of <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> respect to the mean.</p></li>
<li><p>On the contrary, if the standard deviation is <strong>low</strong>, this indicates that
will be obtained small differences when <span class="math notranslate nohighlight">\(\beta_j\)</span> is estimate with
<span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> depending on the sample that is used for estimate it,
that means estimator <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> is <strong>precise</strong>, because it will be little
dispersion of the values of <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> respect to the mean.</p></li>
<li><p>In addition, <span class="math notranslate nohighlight">\(\widehat{s_d}(\widehat{\beta}_j)\)</span> allows to define a confidence interval for <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> estimator .</p></li>
</ul>
<p>We can obtain the estimation fo the standard deviation of coefficient estimators with our class as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">bse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BMI                       0.001211
PhysHlth                  0.005515
Diabetes_1                0.018525
HighBP_1                  0.018611
HighChol_1                0.017194
CholCheck_1               0.044929
Smoker_1                  0.016098
Stroke_1                  0.028673
HeartDiseaseorAttack_1    0.022690
PhysActivity_1            0.017292
Fruits_1                  0.016181
Veggies_1                 0.019040
HvyAlcoholConsump_1       0.035293
AnyHealthcare_1           0.035043
NoDocbcCost_1             0.021647
DiffWalk_1                0.020910
Sex_1                     0.068579
GenHlth_1                 0.036511
GenHlth_2                 0.037133
GenHlth_3                 0.042685
GenHlth_4                 0.064115
Age_1                     0.075156
Age_10                    0.065833
Age_11                    0.069253
Age_12                    0.070626
Age_2                     0.070408
Age_3                     0.067031
Age_4                     0.065220
Age_5                     0.063642
Age_6                     0.062743
Age_7                     0.062230
Age_8                     0.062559
Age_9                     0.063362
Education_1               0.105561
Education_2               0.100409
Education_3               0.096584
Education_4               0.097233
Education_5               0.097640
Income_1                  0.057853
Income_2                  0.055731
Income_3                  0.053784
Income_4                  0.052230
Income_5                  0.051137
Income_6                  0.050598
Income_7                  0.049320
BMI:Sex_1                 0.002192
PhysHlth:Sex_1            0.001291
PhysHlth:GenHlth_1        0.005732
PhysHlth:GenHlth_2        0.005320
PhysHlth:GenHlth_3        0.005267
PhysHlth:GenHlth_4        0.005511
PhysHlth:Income_1         0.002733
PhysHlth:Income_2         0.002738
PhysHlth:Income_3         0.002657
PhysHlth:Income_4         0.002716
PhysHlth:Income_5         0.002652
PhysHlth:Income_6         0.002749
PhysHlth:Income_7         0.002652
alpha                     0.105271
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="confidence-intervals-for-coefficients">
<h3><strong>Confidence intervals for  coefficients</strong><a class="headerlink" href="#confidence-intervals-for-coefficients" title="Link to this heading">#</a></h3>
<p>Confidence intervals for beta coefficients at a level <span class="math notranslate nohighlight">\(1-\alpha\)</span> can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[CI(\beta_j)_{1-\alpha} = \left[\widehat{\beta}_j \hspace{0.1cm} \pm \hspace{0.1cm} t^{n-p-1}_{\alpha/2}\cdot \widehat{s_d}(\widehat{\beta}_j)\right]\]</div>
<p><strong>Observation:</strong></p>
<p>The smaller <span class="math notranslate nohighlight">\(\widehat{s_d}(\widehat{\beta}_j)\)</span>, the smaller <span class="math notranslate nohighlight">\(CI(\beta_j)\)</span>.</p>
<p>Using our class these confidence intervals can be obtained as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">betas_CI</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">betas_CI</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2.5%&#39;</span><span class="p">,</span> <span class="s1">&#39;97.5%&#39;</span><span class="p">]</span>
<span class="n">betas_CI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2.5%</th>
      <th>97.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BMI</th>
      <td>-0.002519</td>
      <td>0.002229</td>
    </tr>
    <tr>
      <th>PhysHlth</th>
      <td>0.026628</td>
      <td>0.048246</td>
    </tr>
    <tr>
      <th>Diabetes_1</th>
      <td>-0.131831</td>
      <td>-0.059214</td>
    </tr>
    <tr>
      <th>HighBP_1</th>
      <td>-0.049509</td>
      <td>0.023445</td>
    </tr>
    <tr>
      <th>HighChol_1</th>
      <td>0.167081</td>
      <td>0.234479</td>
    </tr>
    <tr>
      <th>CholCheck_1</th>
      <td>-0.257783</td>
      <td>-0.081665</td>
    </tr>
    <tr>
      <th>Smoker_1</th>
      <td>0.094747</td>
      <td>0.157851</td>
    </tr>
    <tr>
      <th>Stroke_1</th>
      <td>0.052098</td>
      <td>0.164495</td>
    </tr>
    <tr>
      <th>HeartDiseaseorAttack_1</th>
      <td>-0.059120</td>
      <td>0.029824</td>
    </tr>
    <tr>
      <th>PhysActivity_1</th>
      <td>-0.028178</td>
      <td>0.039605</td>
    </tr>
    <tr>
      <th>Fruits_1</th>
      <td>-0.097810</td>
      <td>-0.034384</td>
    </tr>
    <tr>
      <th>Veggies_1</th>
      <td>-0.049864</td>
      <td>0.024771</td>
    </tr>
    <tr>
      <th>HvyAlcoholConsump_1</th>
      <td>0.229749</td>
      <td>0.368093</td>
    </tr>
    <tr>
      <th>AnyHealthcare_1</th>
      <td>0.090731</td>
      <td>0.228097</td>
    </tr>
    <tr>
      <th>NoDocbcCost_1</th>
      <td>0.331509</td>
      <td>0.416364</td>
    </tr>
    <tr>
      <th>DiffWalk_1</th>
      <td>0.252971</td>
      <td>0.334939</td>
    </tr>
    <tr>
      <th>Sex_1</th>
      <td>-0.527432</td>
      <td>-0.258609</td>
    </tr>
    <tr>
      <th>GenHlth_1</th>
      <td>0.328264</td>
      <td>0.471385</td>
    </tr>
    <tr>
      <th>GenHlth_2</th>
      <td>0.512890</td>
      <td>0.658450</td>
    </tr>
    <tr>
      <th>GenHlth_3</th>
      <td>0.820537</td>
      <td>0.987860</td>
    </tr>
    <tr>
      <th>GenHlth_4</th>
      <td>1.266647</td>
      <td>1.517971</td>
    </tr>
    <tr>
      <th>Age_1</th>
      <td>-0.251993</td>
      <td>0.042612</td>
    </tr>
    <tr>
      <th>Age_10</th>
      <td>-1.470115</td>
      <td>-1.212052</td>
    </tr>
    <tr>
      <th>Age_11</th>
      <td>-1.606503</td>
      <td>-1.335035</td>
    </tr>
    <tr>
      <th>Age_12</th>
      <td>-1.807470</td>
      <td>-1.530620</td>
    </tr>
    <tr>
      <th>Age_2</th>
      <td>-0.340611</td>
      <td>-0.064617</td>
    </tr>
    <tr>
      <th>Age_3</th>
      <td>-0.356241</td>
      <td>-0.093485</td>
    </tr>
    <tr>
      <th>Age_4</th>
      <td>-0.374550</td>
      <td>-0.118893</td>
    </tr>
    <tr>
      <th>Age_5</th>
      <td>-0.465406</td>
      <td>-0.215934</td>
    </tr>
    <tr>
      <th>Age_6</th>
      <td>-0.651130</td>
      <td>-0.405182</td>
    </tr>
    <tr>
      <th>Age_7</th>
      <td>-0.708360</td>
      <td>-0.464425</td>
    </tr>
    <tr>
      <th>Age_8</th>
      <td>-0.957745</td>
      <td>-0.712517</td>
    </tr>
    <tr>
      <th>Age_9</th>
      <td>-1.189101</td>
      <td>-0.940726</td>
    </tr>
    <tr>
      <th>Education_1</th>
      <td>0.961507</td>
      <td>1.375299</td>
    </tr>
    <tr>
      <th>Education_2</th>
      <td>0.950503</td>
      <td>1.344098</td>
    </tr>
    <tr>
      <th>Education_3</th>
      <td>1.064156</td>
      <td>1.442758</td>
    </tr>
    <tr>
      <th>Education_4</th>
      <td>1.149407</td>
      <td>1.530553</td>
    </tr>
    <tr>
      <th>Education_5</th>
      <td>1.221404</td>
      <td>1.604144</td>
    </tr>
    <tr>
      <th>Income_1</th>
      <td>-0.131343</td>
      <td>0.095435</td>
    </tr>
    <tr>
      <th>Income_2</th>
      <td>-0.230547</td>
      <td>-0.012084</td>
    </tr>
    <tr>
      <th>Income_3</th>
      <td>-0.256606</td>
      <td>-0.045777</td>
    </tr>
    <tr>
      <th>Income_4</th>
      <td>-0.260048</td>
      <td>-0.055309</td>
    </tr>
    <tr>
      <th>Income_5</th>
      <td>-0.351059</td>
      <td>-0.150606</td>
    </tr>
    <tr>
      <th>Income_6</th>
      <td>-0.355356</td>
      <td>-0.157016</td>
    </tr>
    <tr>
      <th>Income_7</th>
      <td>-0.464694</td>
      <td>-0.271364</td>
    </tr>
    <tr>
      <th>BMI:Sex_1</th>
      <td>-0.007862</td>
      <td>0.000732</td>
    </tr>
    <tr>
      <th>PhysHlth:Sex_1</th>
      <td>0.003425</td>
      <td>0.008485</td>
    </tr>
    <tr>
      <th>PhysHlth:GenHlth_1</th>
      <td>-0.016621</td>
      <td>0.005846</td>
    </tr>
    <tr>
      <th>PhysHlth:GenHlth_2</th>
      <td>-0.017822</td>
      <td>0.003031</td>
    </tr>
    <tr>
      <th>PhysHlth:GenHlth_3</th>
      <td>-0.020083</td>
      <td>0.000564</td>
    </tr>
    <tr>
      <th>PhysHlth:GenHlth_4</th>
      <td>-0.032552</td>
      <td>-0.010951</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_1</th>
      <td>-0.006098</td>
      <td>0.004616</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_2</th>
      <td>-0.006017</td>
      <td>0.004717</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_3</th>
      <td>-0.003210</td>
      <td>0.007204</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_4</th>
      <td>-0.010477</td>
      <td>0.000168</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_5</th>
      <td>-0.003784</td>
      <td>0.006613</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_6</th>
      <td>-0.009766</td>
      <td>0.001010</td>
    </tr>
    <tr>
      <th>PhysHlth:Income_7</th>
      <td>-0.007049</td>
      <td>0.003346</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>5.596406</td>
      <td>6.009062</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="prediction">
<h3><strong>Prediction</strong><a class="headerlink" href="#prediction" title="Link to this heading">#</a></h3>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for individuals with the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span> for the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i = e^{\widehat{\beta}_0 + x_{i}^{\prime} \cdot \widehat{\beta}}= exp \left\lbrace \widehat{\beta}_0 + x_{i}^{\prime} \cdot \widehat{\beta} \right\rbrace\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">full_model_inter_dummies</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing predictions</span>
<span class="n">Y_train_hat</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="c1"># Computing RMSE</span>
<span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_train_hat</span> <span class="o">-</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.271751356023486
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictors-selection">
<h3><strong>Predictors Selection</strong><a class="headerlink" href="#predictors-selection" title="Link to this heading">#</a></h3>
<p>In this section we are going to explore several methods to select predictors.</p>
<p>Given a data set with <span class="math notranslate nohighlight">\(p\)</span> predictors, the number of possible linear regression model that can be trained with a subset (all included) of them is:</p>
<div class="math notranslate nohighlight">
\[\sum_{k=1}^p C(p,k) = \sum_{k=1}^p \dfrac{p!}{k! (p-k)!}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[C(p,k) = \dfrac{p!}{k! (p-k)!}\]</div>
<p>is the  number of possible combinations of <span class="math notranslate nohighlight">\(k\)</span> objects selected from a set of <span class="math notranslate nohighlight">\(p\)</span> objects, without repetition and where the order does not matter, is given by the binomial coefficient:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binom</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2097151.0
</pre></div>
</div>
</div>
</div>
<p>In this case we can train 2097151 different Poisson regression model with our data set, that has <span class="math notranslate nohighlight">\(p=21\)</span> predictors.</p>
<p>So, we are interested in a way to select the “best” combination of predictors. There is no definitive method, so, we will see several options.</p>
<section id="significance-test">
<h4><strong>Significance test</strong><a class="headerlink" href="#significance-test" title="Link to this heading">#</a></h4>
<p>\begin{cases}
H_0 : \beta_j = 0 \
H_1 : \beta_j \neq 0
\end{cases}</p>
<p><strong>Statistic:</strong></p>
<div class="math notranslate nohighlight">
\[z_{exp} = \dfrac{\widehat{\beta}_j - \beta_j}{sd(\widehat{\beta}_j)} =_{H_0} \dfrac{\widehat{\beta}_j }{sd(\widehat{\beta}_j)} \rightarrow N(0,1)\]</div>
<p><strong>p-value:</strong></p>
<div class="math notranslate nohighlight">
\[\text{p-value} = P\left(N(0,1) \geq \dfrac{\widehat{\beta}_j }{sd(\widehat{\beta}_j)}\right)\]</div>
<p><strong>Decision rule based in p-value:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\text{p-value} &lt; \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>significative</strong> to explain the response.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\text{p-value} \geq \alpha \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> Not Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>not significative</strong> to explain the response.</p></li>
</ul>
<p><strong>Decision rule basede in confidence intervals:</strong></p>
<p>This test can be performed with the <span class="math notranslate nohighlight">\(CI(\beta_j) = \left[\widehat{\beta}_j \pm z_{1-\alpha/2}\cdot sd(\widehat{\beta}_j)\right]\)</span> as follows:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(0\in CI(\beta_j)\Rightarrow\)</span> Not reject <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(0\not\in CI(\beta_j)\Rightarrow\)</span>  Reject <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
</ul>
<p>The following function allow us to extract the significant predictors of a given linear regression model according to the above test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">significant_test</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="p">:</span>

    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">values</span>
    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">significant_results</span> <span class="o">=</span> <span class="n">pvalues</span> <span class="o">&lt;</span> <span class="n">alpha</span>

    <span class="n">significant_predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    <span class="n">not_significant_predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">significant_results_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_results</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significant_results_str</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predictors</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significant_results_str</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> 
                         <span class="n">y</span><span class="o">=</span><span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Significance Test&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Significant&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">significant_predictors</span><span class="p">,</span> <span class="n">not_significant_predictors</span>
</pre></div>
</div>
</div>
</div>
<p>The idea is to applied this method to the full model (the one that include all the predictors) to identify which of them are not significative (according to the above test), and therefore we will select one combination of predictors, the significative one.</p>
<p>Since we have four full models, as we explained before, we will apply the test to all of them, and we will obtain a “final” set of predictors in each case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_inter_dummies</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/43d564972daa7c2142cba50676977980e1d5b631bdf4d5fa0ff1f4db75e72034.png" src="_images/43d564972daa7c2142cba50676977980e1d5b631bdf4d5fa0ff1f4db75e72034.png" />
</div>
</div>
<p>Given a categorical predictor, if at least one dummy is significative, we consider the predictor significative. And the same for the interactions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recognition</span><span class="p">(</span><span class="n">initial_list</span><span class="p">):</span>
    <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">initial_list</span> <span class="p">:</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
            <span class="n">list_strings</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_strings</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">output_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">output_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">,</span> <span class="n">interactions_selected</span><span class="p">,</span> <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">not_significant_pred_model_inter_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">not_significant</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">])</span> 

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span>  <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Smoker&#39;,
 &#39;Education&#39;,
 &#39;CholCheck&#39;,
 &#39;Fruits&#39;,
 &#39;HvyAlcoholConsump&#39;,
 &#39;HighChol&#39;,
 &#39;PhysHlth&#39;,
 &#39;AnyHealthcare&#39;,
 &#39;Sex&#39;,
 &#39;Stroke&#39;,
 &#39;GenHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;Diabetes&#39;,
 &#39;Age&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;PhysHlth&#39;, &#39;Sex&#39;), (&#39;PhysHlth&#39;, &#39;GenHlth&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">significant_pred_model_inter_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_inter</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cf11e885e751823848097bf31d9d0eba8a144e614b8236a636ec66f81c87c890.png" src="_images/cf11e885e751823848097bf31d9d0eba8a144e614b8236a636ec66f81c87c890.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span>  <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Smoker&#39;,
 &#39;Education&#39;,
 &#39;CholCheck&#39;,
 &#39;Fruits&#39;,
 &#39;HvyAlcoholConsump&#39;,
 &#39;HighChol&#39;,
 &#39;PhysHlth&#39;,
 &#39;AnyHealthcare&#39;,
 &#39;Sex&#39;,
 &#39;Stroke&#39;,
 &#39;GenHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;Diabetes&#39;,
 &#39;Age&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;PhysHlth&#39;, &#39;Sex&#39;), (&#39;PhysHlth&#39;, &#39;GenHlth&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">significant_pred_model_dummies_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_dummies</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">13</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01625789cd1f1115d6d5067f50000cb6bce0258c19b972f3fdd446a6e5b7f5b6.png" src="_images/01625789cd1f1115d6d5067f50000cb6bce0258c19b972f3fdd446a6e5b7f5b6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">significant_pred_model_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">not_significant_pred_model_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">not_significant</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">significant_pred_model_dummies_ST</span><span class="p">])</span> 

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_dummies_ST</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Smoker&#39;, &#39;Education&#39;, &#39;CholCheck&#39;, &#39;Fruits&#39;, &#39;HvyAlcoholConsump&#39;,
       &#39;HighChol&#39;, &#39;PhysHlth&#39;, &#39;AnyHealthcare&#39;, &#39;Sex&#39;, &#39;Stroke&#39;,
       &#39;GenHlth&#39;, &#39;DiffWalk&#39;, &#39;NoDocbcCost&#39;, &#39;Diabetes&#39;, &#39;Age&#39;, &#39;Income&#39;],
      dtype=&#39;&lt;U17&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - not interactions - not dummies</span>
<span class="n">significant_pred_model_basic_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_basic_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c3246e1954ebd6afe86384c878f601200d44e14883da13d836e614d841bd49b1.png" src="_images/c3246e1954ebd6afe86384c878f601200d44e14883da13d836e614d841bd49b1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_basic_ST</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Diabetes&#39;, &#39;HighChol&#39;, &#39;CholCheck&#39;, &#39;BMI&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;,
       &#39;HeartDiseaseorAttack&#39;, &#39;PhysActivity&#39;, &#39;Fruits&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="goodness-of-fit">
<h4><strong>Goodness of fit</strong><a class="headerlink" href="#goodness-of-fit" title="Link to this heading">#</a></h4>
<section id="deviance">
<h5><strong>Deviance</strong><a class="headerlink" href="#deviance" title="Link to this heading">#</a></h5>
<p>Given an statistical regression model <span class="math notranslate nohighlight">\(M\)</span>, such as Poisson regression model, its deviance is defined as:</p>
<div class="math notranslate nohighlight">
\[D(M) = -2 \cdot log \left( \mathcal{L}(\widehat{\beta}_0, \widehat{\beta}) \right)\]</div>
<p>Where <span class="math notranslate nohighlight">\(\mathcal{L}(\widehat{\beta}_0, \widehat{\beta})\)</span> is the estimated Likelihood function of the model.</p>
<p>The deviance is a measure of how well the model is fitting the training data, so, is a measure of <strong>goodness of fit</strong> of the model.</p>
<p><strong>Properties:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(D(M)\in [0, \infty)\)</span></p></li>
<li><p>The larger <span class="math notranslate nohighlight">\(D(M)\)</span>, the worse <span class="math notranslate nohighlight">\(M\)</span> fits the training data.</p></li>
<li><p>The smaller <span class="math notranslate nohighlight">\(D(M)\)</span>, the better <span class="math notranslate nohighlight">\(M\)</span> fits the training data.</p></li>
<li><p>The null model <span class="math notranslate nohighlight">\(M_0\)</span> (the one that doesn’t include predictors) has the maximum deviance.</p></li>
<li><p>The classic determination coefficient <span class="math notranslate nohighlight">\(R\)</span>-square can be obtain through the deviance as <span class="math notranslate nohighlight">\(\hspace{0.05cm}R^2(M) = 1 - \dfrac{D(M)}{D(M_0)}\)</span></p></li>
</ul>
</section>
</section>
<section id="likelihood-ratio-test-as-significance-test">
<h4><strong>Likelihood Ratio Test as significance test</strong><a class="headerlink" href="#likelihood-ratio-test-as-significance-test" title="Link to this heading">#</a></h4>
<p>Originally the Likelihood ratio test is a test to compare the goodness of fit of different nested models, but in this section we are going to adapt it to be a significance test for the predictors.</p>
<p>Given two nested models <span class="math notranslate nohighlight">\(M_p\)</span>, <span class="math notranslate nohighlight">\(M_{p-1}\)</span> such that <span class="math notranslate nohighlight">\(M_p\)</span> is the full model (includes the <span class="math notranslate nohighlight">\(p\)</span> available predictors) and <span class="math notranslate nohighlight">\(M_{p-1}\)</span> is the same model but without the predictor <span class="math notranslate nohighlight">\(X_j\)</span>.</p>
<p>The significant test for predictor <span class="math notranslate nohighlight">\(X_j\)</span> can be perform as a Likelihood Ratio Test:</p>
<p>\begin{cases}
H_0 : M_{p-1}  \
H_1 : M_p
\end{cases}</p>
<p><strong>Statistic:</strong></p>
<div class="math notranslate nohighlight">
\[LTR = D(M_{p-1}) - D(M_p) \sim \chi_{1}^2\]</div>
<p><strong>p-value:</strong></p>
<div class="math notranslate nohighlight">
\[pvalue = P(\chi_{1}^2 \geq LRT)\]</div>
<p><strong>Decision rule:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(pvalue &lt; \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span>  <span class="math notranslate nohighlight">\(M_p\)</span> fits better the training data than <span class="math notranslate nohighlight">\(M_{p-1}\)</span>    <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>significative</strong> to explain the response.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(pvalue \geq \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Not Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span>  <span class="math notranslate nohighlight">\(M_{p-1}\)</span> fits better the training data than <span class="math notranslate nohighlight">\(M_{p}\)</span>  <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>not significative</strong> to explain the response.</p></li>
</ul>
<p>Let’s implements the Likelihood Test Ratio as significance test in <code class="docutils literal notranslate"><span class="pre">Python</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">LRT</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">predictor_to_test</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">X_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">X</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">Y</span>
    <span class="n">interactions</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span>
    <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">pred_to_dummies</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">X_full</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">predictor_to_test</span> <span class="ow">in</span> <span class="n">predictors</span><span class="p">:</span>
        <span class="n">predictors_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span>
        <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">cat</span> <span class="o">!=</span> <span class="n">predictor_to_test</span> <span class="ow">and</span> <span class="n">quant</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span>  <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred_to_dummies</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span> <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">predictor_to_test</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="n">predictors_reduced</span> <span class="o">=</span> <span class="n">predictors</span>
        <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span>
        <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>

    <span class="n">reduced_model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_full</span><span class="p">[</span><span class="n">predictors_reduced</span><span class="p">])</span>
    <span class="n">reduced_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_reduced</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_reduced</span><span class="p">)</span>

    <span class="n">loglike_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">llf</span>
    <span class="n">loglike_reduced</span> <span class="o">=</span> <span class="n">reduced_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">llf</span>
    <span class="n">deviance_full</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">loglike_full</span>
    <span class="n">deviance_reduced</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">loglike_reduced</span>
    <span class="n">LRT_</span> <span class="o">=</span> <span class="n">deviance_reduced</span> <span class="o">-</span> <span class="n">deviance_full</span>
    <span class="n">df_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">df_model</span> <span class="c1"># number of coefficients of full model</span>
    <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">reduced_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">df_model</span> <span class="c1"># number of coefficients of reduced model </span>
    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">LRT_</span><span class="p">,</span> <span class="n">df_full</span><span class="o">-</span><span class="n">df_reduced</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pvalue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span> <span class="p">:</span>

    <span class="k">if</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">predictors_to_test</span> <span class="o">=</span>  <span class="n">full_model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictors_to_test</span> <span class="o">=</span>  <span class="n">full_model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="n">pvalue</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">predictor</span> <span class="ow">in</span> <span class="n">predictors_to_test</span> <span class="p">:</span>
        <span class="n">pvalue</span><span class="p">[</span><span class="n">predictor</span><span class="p">]</span> <span class="o">=</span> <span class="n">LRT</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">predictor_to_test</span><span class="o">=</span><span class="n">predictor</span><span class="p">)</span>
    
    <span class="n">predictors_tested</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">significance_results</span> <span class="o">=</span> <span class="n">pvalues</span> <span class="o">&lt;</span> <span class="n">alpha</span>
    <span class="n">significant_predictors</span> <span class="o">=</span> <span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    <span class="n">not_significant_predictors</span> <span class="o">=</span> <span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">significance_test_results_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significance_results</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significance_test_results_str</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predictors_tested</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significance_test_results_str</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> 
                         <span class="n">y</span><span class="o">=</span><span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Significance Test - LRT&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Significant&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">significant_predictors</span><span class="p">,</span> <span class="n">not_significant_predictors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">full_model_inter_dummies</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>

<span class="n">significant_pred_model_inter_dummies_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_dummies_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_inter_dummies</span><span class="p">,</span> 
                                                                                                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/369d92645fc0230f0a69506bdc135f2a8a9029dd0173c250e47daa0aa00bd247.png" src="_images/369d92645fc0230f0a69506bdc135f2a8a9029dd0173c250e47daa0aa00bd247.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_inter_dummies_LRT</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Diabetes&#39;, &#39;HighChol&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;, &#39;Fruits&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;,
       &quot;(&#39;PhysHlth&#39;, &#39;Sex&#39;)&quot;, &quot;(&#39;PhysHlth&#39;, &#39;GenHlth&#39;)&quot;], dtype=&#39;&lt;U23&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">not_significant_pred_model_inter_dummies_LRT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;HighBP&#39;, &#39;CholCheck&#39;, &#39;BMI&#39;, &#39;HeartDiseaseorAttack&#39;,
       &#39;PhysActivity&#39;, &#39;Veggies&#39;, &quot;(&#39;BMI&#39;, &#39;Sex&#39;)&quot;,
       &quot;(&#39;PhysHlth&#39;, &#39;Income&#39;)&quot;], dtype=&#39;&lt;U23&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_LRT</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_LRT</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Diabetes&#39;,
 &#39;HighChol&#39;,
 &#39;Smoker&#39;,
 &#39;Stroke&#39;,
 &#39;Fruits&#39;,
 &#39;HvyAlcoholConsump&#39;,
 &#39;AnyHealthcare&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;GenHlth&#39;,
 &#39;PhysHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;Sex&#39;,
 &#39;Age&#39;,
 &#39;Education&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;PhysHlth&#39;, &#39;Sex&#39;), (&#39;PhysHlth&#39;, &#39;GenHlth&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">significant_pred_model_inter_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_inter</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b991746d4f067b0473d6dcecdac2ec5677c0a39f2a4b732c84a8d46092354095.png" src="_images/b991746d4f067b0473d6dcecdac2ec5677c0a39f2a4b732c84a8d46092354095.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_LRT</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_LRT</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Diabetes&#39;,
 &#39;HighChol&#39;,
 &#39;CholCheck&#39;,
 &#39;BMI&#39;,
 &#39;Smoker&#39;,
 &#39;Stroke&#39;,
 &#39;PhysActivity&#39;,
 &#39;Fruits&#39;,
 &#39;HvyAlcoholConsump&#39;,
 &#39;AnyHealthcare&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;GenHlth&#39;,
 &#39;PhysHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;Sex&#39;,
 &#39;Age&#39;,
 &#39;Education&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;BMI&#39;, &#39;Sex&#39;),
 (&#39;PhysHlth&#39;, &#39;Sex&#39;),
 (&#39;PhysHlth&#39;, &#39;GenHlth&#39;),
 (&#39;PhysHlth&#39;, &#39;Income&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">significant_pred_model_dummies_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_dummies_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_dummies</span><span class="p">,</span> 
                                                                                                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d42cef8ae386b0dec91fed4224dd715139908402ba77348a19e3a3ae14a7d54a.png" src="_images/d42cef8ae386b0dec91fed4224dd715139908402ba77348a19e3a3ae14a7d54a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_dummies_LRT</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Diabetes&#39;, &#39;HighChol&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;, &#39;Fruits&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;],
      dtype=&#39;&lt;U20&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - not interactions - not dummies</span>
<span class="n">significant_pred_model_basic_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_basic_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model</span><span class="p">,</span> 
                                                                                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ad32b28a0271dfb2e385b6972c7ebc46dc23961635dfd519cb6bc9e46b36bad.png" src="_images/0ad32b28a0271dfb2e385b6972c7ebc46dc23961635dfd519cb6bc9e46b36bad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_basic_LRT</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Diabetes&#39;, &#39;HighChol&#39;, &#39;CholCheck&#39;, &#39;BMI&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;,
       &#39;HeartDiseaseorAttack&#39;, &#39;PhysActivity&#39;, &#39;Fruits&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;],
      dtype=&#39;&lt;U20&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictors-selection-based-on-predictive-performance">
<h4><strong>Predictors selection based on predictive performance</strong><a class="headerlink" href="#predictors-selection-based-on-predictive-performance" title="Link to this heading">#</a></h4>
<p>The idea is to consider the predictors as hyper-parameters of the model and optimize them using algorithms like grid search and cross validation.</p>
<section id="train-train-train-validate-split">
<h5><strong>Train-Train - Train-Validate split</strong><a class="headerlink" href="#train-train-train-validate-split" title="Link to this heading">#</a></h5>
<p>Since we need to test the predictive performance of the models we need to split train partition in train-train (train2) to train the models and train-validate (val) to test them.</p>
<p>We don’t use test partition in this case since this task implies taking decisions regarding the predictive modeling process and these decisions should be done with the training data, otherwise this can lead to <strong>data leakage</strong>.</p>
<p>The test partition will only be  used to estimate the future performance of our final model.</p>
</section>
<section id="best-subset-selection-algorithm">
<h5><strong>Best subset selection algorithm</strong><a class="headerlink" href="#best-subset-selection-algorithm" title="Link to this heading">#</a></h5>
<p>We have <span class="math notranslate nohighlight">\(p\)</span> predictors.</p>
<ul class="simple">
<li><p>We consider all the possible poisson models with  <span class="math notranslate nohighlight">\(1\)</span> predictor, and select the one with <strong>less (test) prediction error</strong> computed by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_1^*\)</span></p></li>
<li><p>We consider all the possible poisson models with  <span class="math notranslate nohighlight">\(2\)</span> predictor, and select the one with <strong>less (test) prediction error</strong> computed by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_2^*\)</span><br />
<span class="math notranslate nohighlight">\(\dots\)</span></p></li>
<li><p>We train all the possible poisson models with  <span class="math notranslate nohighlight">\(p-1\)</span> predictor, and select the one with <strong>less (test) prediction error</strong> computed by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We train the full poisson model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
</ul>
<p>Among the models <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with <strong>less (test) prediction error</strong>, and it is consider the <strong>best Poisson model</strong> according to best subset selection algorithm.</p>
<p>This method is not feasible in this case. Because as we saw before, the number of possible linear regression models that can be trained with all the possible subsets of the <span class="math notranslate nohighlight">\(p=21\)</span> predictors is <span class="math notranslate nohighlight">\(2097151\)</span>, which is not acceptable computationally with the <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation of the Poisson regression model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">binom_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">binom_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Num. Possible combinations&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Num. predictors (k)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binomial coefficient in Best-subset selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fa06e3a0b3597ba26854cfe94785bfbf92ee2d951b35371f446bc258691f2ccc.png" src="_images/fa06e3a0b3597ba26854cfe94785bfbf92ee2d951b35371f446bc258691f2ccc.png" />
</div>
</div>
<p>We have <span class="math notranslate nohighlight">\(350000\)</span> possible combinations of size <span class="math notranslate nohighlight">\(k=10\)</span> of <span class="math notranslate nohighlight">\(p=21\)</span> predictors, this means that just in this case we would have to train <span class="math notranslate nohighlight">\(350000\)</span> models !</p>
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">statmodels</span></code> takes 1.5 secs to train each model (which is an optimistic assumption), this task would be performed in 6 days !!</p>
<p>And this is only one of the task that this algorithm should perform, because it has to carry out this process for <span class="math notranslate nohighlight">\(k=1,2,\dots,p\)</span>.</p>
<p>By the way, the total number of model to train will be exactly the sum of <code class="docutils literal notranslate"><span class="pre">binom_values</span></code>, as we said before there are 2097151 possible combinations !</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2097151.0
</pre></div>
</div>
</div>
</div>
<p>The time expected to train this models would be 36 days…</p>
</section>
<section id="backward-selection-algorithm">
<h5><strong>Backward selection algorithm</strong><a class="headerlink" href="#backward-selection-algorithm" title="Link to this heading">#</a></h5>
<p>From the largest model to the smallest.</p>
<p>We have <span class="math notranslate nohighlight">\(p\)</span> predictors.</p>
<ul>
<li><p>We consider the full poisson regression model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
<li><p>We consider all the  poisson models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_p\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We consider all the  poisson models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_{p-1}\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{p-2}^*\)</span></p>
<p><span class="math notranslate nohighlight">\(\dots\)</span></p>
</li>
<li><p>We consider all the  poisson models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_2\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{1}^*\)</span></p></li>
</ul>
<p>Among the models <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with <strong>less (test) prediction error</strong>, and it is consider the <strong>best Poisson model</strong> according to backward selection algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">binom_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>
<span class="n">binom_values</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">binom_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Num. Combinations&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binomial coefficient in Backward selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5793720a57dd903a414f416c24518f5b38f95dbf86a2666983c17d9329b979b9.png" src="_images/5793720a57dd903a414f416c24518f5b38f95dbf86a2666983c17d9329b979b9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>231.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">231</span><span class="o">*</span><span class="mf">1.5</span><span class="o">/</span><span class="mi">60</span> <span class="c1"># 6 mins approx</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.775
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">backward_selection</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
     
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="p">[</span><span class="n">predictors</span><span class="p">]</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">predictors_combi</span> <span class="ow">in</span> <span class="n">predictors_combinations</span> <span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">predictors_combi</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)</span>

            <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)])</span>
            <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred_to_dummies</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_reduced</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_reduced</span><span class="p">)</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)])</span>
            <span class="n">RMSE</span><span class="p">[</span><span class="n">predictors_combi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
     
        <span class="n">RMSE_predictors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">RMSE_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">best_predictors</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">RMSE_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span> 
        <span class="n">best_interactions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)])</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">best_interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span> <span class="o">+</span> <span class="n">best_interactions</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="c1"># Next list of combinations</span>
        <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># Clean the dictionary</span>
        <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Models with: dummies - interactions</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">backward_selection</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> 
                             <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_backward_inter_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_backward_inter_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_backward_inter_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_backward_inter_dummies</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_backward_inter_dummies</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Education&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_backward_inter_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_backward_inter_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Backward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6c41d6f7cd2d71530e819092b8503844141c543570b9797b7a17e357e88a8230.png" src="_images/6c41d6f7cd2d71530e819092b8503844141c543570b9797b7a17e357e88a8230.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dummies</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">backward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_backward_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_backward_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_backward_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_backward_dummies</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;backward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Education&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_backward_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_backward_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Backward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e1ee12a264b7e5ea3f17c633a6310b013fa8d9847444b1a2e11d8df372c3bc7b.png" src="_images/e1ee12a264b7e5ea3f17c633a6310b013fa8d9847444b1a2e11d8df372c3bc7b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># interactions</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">backward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_backward_inter_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_backward_inter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_backward_inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_backward_inter</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_backward_inter</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;backward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;HighBP&#39;,
 &#39;HighChol&#39;,
 &#39;CholCheck&#39;,
 &#39;HeartDiseaseorAttack&#39;,
 &#39;PhysActivity&#39;,
 &#39;Fruits&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;GenHlth&#39;,
 &#39;PhysHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;Sex&#39;,
 &#39;Age&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;PhysHlth&#39;, &#39;Sex&#39;), (&#39;PhysHlth&#39;, &#39;GenHlth&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_backward_inter</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_backward_inter_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Backward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a7b022f22e974e8c69ad31c3b3f91deb0a34c415dece2f588b71c3a4ed45e77c.png" src="_images/a7b022f22e974e8c69ad31c3b3f91deb0a34c415dece2f588b71c3a4ed45e77c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basic (not inter - not dummies)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">backward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_backward_basic_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_backward_basic</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_backward_basic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_backward_basic</span> 
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;backward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;backward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;backward_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;HighBP&#39;,
 &#39;HighChol&#39;,
 &#39;CholCheck&#39;,
 &#39;Smoker&#39;,
 &#39;HeartDiseaseorAttack&#39;,
 &#39;PhysActivity&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;GenHlth&#39;,
 &#39;PhysHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;Age&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_backward_basic</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_backward_basic_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Backward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8ea0f8c2c81152569b8ebf20096a73a3f746815c0e220467e70a9db63ef92bbb.png" src="_images/8ea0f8c2c81152569b8ebf20096a73a3f746815c0e220467e70a9db63ef92bbb.png" />
</div>
</div>
</section>
<section id="forward-selection-algorithm">
<h5><strong>Forward selection algorithm</strong><a class="headerlink" href="#forward-selection-algorithm" title="Link to this heading">#</a></h5>
<p>From the smallest model to the largest.</p>
<p>We have <span class="math notranslate nohighlight">\(p\)</span> predictors.</p>
<ul>
<li><p>We consider all the poisson regression models with <span class="math notranslate nohighlight">\(1\)</span> predictor,  and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{1}^*\)</span></p></li>
<li><p>We consider all the  linear models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_1\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{2}^*\)</span></p></li>
<li><p>We consider all the  linear models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_2\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{3}^*\)</span></p>
<p><span class="math notranslate nohighlight">\(\dots\)</span></p>
</li>
<li><p>We consider all the  linear models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_p-2\)</span>, and we select the one with <strong>less (test) prediction error</strong> by <strong>simple validation</strong> <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We consider the full linear model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
</ul>
<p>Among the models <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with <strong>less (test) prediction error</strong>, and it is consider the <strong>best Poisson model</strong> according to forward selection algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">binom_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>
<span class="n">binom_values</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">binom_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Num. Combinations&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">binom_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binomial coefficient in Forward selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/285aeaba1a33f181750fff67d0c93b28af10e5ff14461cee4769f5f392a60eae.png" src="_images/285aeaba1a33f181750fff67d0c93b28af10e5ff14461cee4769f5f392a60eae.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forward_selection</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span>  <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="n">predictors</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">predictors_combi</span> <span class="ow">in</span> <span class="n">predictors_combinations</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span>
               <span class="n">predictors_combi</span> <span class="o">=</span> <span class="p">(</span><span class="n">predictors_combi</span><span class="p">,</span> <span class="p">)</span>

            <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)])</span>
            <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred_to_dummies</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_reduced</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_reduced</span><span class="p">)</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)])</span>
            <span class="n">RMSE</span><span class="p">[</span><span class="n">predictors_combi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">RMSE_predictors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">RMSE_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">best_predictors</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">RMSE_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">best_interactions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)])</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">best_interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span> <span class="o">+</span> <span class="n">best_interactions</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="c1"># Next list of combinations</span>
        <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_predictors</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_predictors</span><span class="p">]</span>
        <span class="c1"># Clean the dictionary</span>
        <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># interactions - dummies - interactions</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">forward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> 
                            <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_forward_inter_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_forward_inter_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_forward_inter_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_forward_inter_dummies</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_forward_inter_dummies</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Education&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_forward_inter_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_forward_inter_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6216e289853b9cf7dca03db30a7017b1eb222123ea2945559940f5b611947e16.png" src="_images/6216e289853b9cf7dca03db30a7017b1eb222123ea2945559940f5b611947e16.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dummies </span>
<span class="n">results</span> <span class="o">=</span> <span class="n">forward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_forward_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_forward_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_forward_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_forward_dummies</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;forward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;forward_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Education&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_forward_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_forward_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/22b943e37ba8dfa92f0d43b1e622fe4a14b1a6c79725777ed005c39009f0acf0.png" src="_images/22b943e37ba8dfa92f0d43b1e622fe4a14b1a6c79725777ed005c39009f0acf0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># interactions - interaction </span>
<span class="n">results</span> <span class="o">=</span> <span class="n">forward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;GenHlth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_forward_inter_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_forward_inter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_forward_inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_forward_inter</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;forward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_forward_inter</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;forward_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_forward_inter</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_forward_inter_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ce1c30a94ddd6fc9ec4a85b0c1866df271eef112df25f410fa6afc328a42c3c1.png" src="_images/ce1c30a94ddd6fc9ec4a85b0c1866df271eef112df25f410fa6afc328a42c3c1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># interactions - basic </span>
<span class="n">results</span> <span class="o">=</span> <span class="n">forward_selection</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_forward_basic_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_forward_basic</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_forward_basic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_forward_basic</span> 
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;forward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;forward_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;forward_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;GenHlth&#39;,
 &#39;PhysHlth&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;Age&#39;,
 &#39;CholCheck&#39;,
 &#39;DiffWalk&#39;,
 &#39;Income&#39;,
 &#39;HighChol&#39;,
 &#39;HeartDiseaseorAttack&#39;,
 &#39;HighBP&#39;,
 &#39;PhysActivity&#39;,
 &#39;Smoker&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_forward_basic</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_forward_basic_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Forward Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f7c2a19e17aa667ef8ce4160d74dca9c5f39f7ab41f149b1f32d5b9df09afad.png" src="_images/7f7c2a19e17aa667ef8ce4160d74dca9c5f39f7ab41f149b1f32d5b9df09afad.png" />
</div>
</div>
</section>
</section>
</section>
<section id="model-selection">
<h3><strong>Model selection</strong><a class="headerlink" href="#model-selection" title="Link to this heading">#</a></h3>
<p>Since we we want to compare different models based on their predictive performance we need to use train-train (train2) to train them and train-validate (val) to test them, so that we will be able to compare their “real” predictive performance and choose the best one.</p>
<p>We don’t use test partition in model selection because it is part of training, since implies taking decisions regarding the predictive modeling process and this can lead to <strong>data leakage</strong>.</p>
<p>The test partition will only be  used  to estimate the future performance of our final model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">repeated_simple_validation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">):</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">seed_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">)</span>
    <span class="n">RMSE_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed_arr</span><span class="p">[</span><span class="nb">iter</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># If X_test contains categorical variable without some categories that are present in X_train, an error will occur.</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">RMSE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">continue</span>

    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RMSE_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kfold_cv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">,</span> <span class="p">):</span>

    
    <span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">))</span>
    <span class="n">RMSE_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">)</span> <span class="p">:</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span> <span class="p">;</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">Y_train</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="p">;</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># If X_test contains categorical variable without some categories that are present in X_train, an error will occur.</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">RMSE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">continue</span>

    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RMSE_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_rep_sv</span><span class="p">,</span> <span class="n">RMSE_kfold</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>

    <span class="n">RMSE_kfold</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">kfold_cv</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                             <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                             <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> 
                             <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_kfold_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE_kfold</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">Models_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Linear_&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE_kfold</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

<span class="n">Best_Model_kfold</span> <span class="o">=</span> <span class="n">Models_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">RMSE_Best_Model_kfold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_kfold_arr</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Models_arr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_Best_Model_kfold</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Best_Model_kfold</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - kfold CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE (kfold CV)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/683f608fe8bb42d60b6edcc7dd6fcc05eded01908dbfd249eeabc992e3c4c163.png" src="_images/683f608fe8bb42d60b6edcc7dd6fcc05eded01908dbfd249eeabc992e3c4c163.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mf">7.5</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Models_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mf">7.5</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_Best_Model_kfold</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Best_Model_kfold</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - kfold CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE (kfold CV)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mf">7.5</span><span class="p">])</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mf">7.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/959f85d88486e854574f8a6b66b77bdf8af87168dcb52823e4f3601f3e00d220.png" src="_images/959f85d88486e854574f8a6b66b77bdf8af87168dcb52823e4f3601f3e00d220.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Best_Model_kfold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Linear_ST_inter&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_Best_Model_kfold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.339183127806211
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Smoker&#39;,
 &#39;Education&#39;,
 &#39;CholCheck&#39;,
 &#39;Fruits&#39;,
 &#39;HvyAlcoholConsump&#39;,
 &#39;HighChol&#39;,
 &#39;PhysHlth&#39;,
 &#39;AnyHealthcare&#39;,
 &#39;Sex&#39;,
 &#39;Stroke&#39;,
 &#39;GenHlth&#39;,
 &#39;DiffWalk&#39;,
 &#39;NoDocbcCost&#39;,
 &#39;Diabetes&#39;,
 &#39;Age&#39;,
 &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;PhysHlth&#39;, &#39;Sex&#39;), (&#39;PhysHlth&#39;, &#39;GenHlth&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimation-of-future-performance">
<h3><strong>Estimation of future performance</strong><a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h3>
<p>In this section we are going to estimate the future predictive performance of the best model (the one selected in the precious section).
To estimate the future performance of the model we will use the training partition to train the model and the testing to make predictions an estimate the error, i.e, its future performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statsmodels doesn&#39;t work with Polars but Pandas.</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">])</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]])</span>
<span class="n">RMSE_future_performance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.300893262886675
</pre></div>
</div>
</div>
</div>
</section>
<section id="prediction-intervals">
<h3><strong>Prediction intervals</strong><a class="headerlink" href="#prediction-intervals" title="Link to this heading">#</a></h3>
<section id="using-monte-linear-regression-formula">
<h4><strong>Using Monte Linear Regression formula</strong><a class="headerlink" href="#using-monte-linear-regression-formula" title="Link to this heading">#</a></h4>
<p>We will use the same formula used in Linear Regression to build the prediction intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">)):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t_alpha_2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
    <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">sigma_2_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X_test</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">)])</span>

    <span class="n">L1</span> <span class="o">=</span> <span class="n">Y_test_hat</span> <span class="o">-</span> <span class="n">t_alpha_2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_2_est</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">))</span> <span class="c1"># lower bound</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">Y_test_hat</span> <span class="o">+</span> <span class="n">t_alpha_2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_2_est</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">))</span> <span class="c1"># upper bound</span>

    <span class="n">prop_Y_test_out_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">&lt;</span> <span class="n">L1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y_test</span> <span class="o">&gt;</span> <span class="n">L2</span><span class="p">))</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">subset_len</span> <span class="o">=</span> <span class="n">subset_len</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                      <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Predictions - Test&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;fuchsia&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Real Values - Test&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y_test_hat&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;X_test - Index [0:</span><span class="si">{</span><span class="n">subset_len</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction Intervals - Test Set&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.32</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The percentage of real values of the response (all the red points) that are out of the prediction intervals is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop_Y_test_out_interval</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]],</span> <span class="n">Y</span><span class="p">,</span> 
                     <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">],</span> 
                     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4d5bb3d94de75335a4aa7f087aa08fdf2bfa01ac3b3bf479e6b42853a1cf1252.png" src="_images/4d5bb3d94de75335a4aa7f087aa08fdf2bfa01ac3b3bf479e6b42853a1cf1252.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The percentage of real values of the response (all the red points) that are out of the prediction intervals is 7.62 %
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-monte-carlo-simulation">
<h4><strong>Using Monte Carlo Simulation</strong><a class="headerlink" href="#using-monte-carlo-simulation" title="Link to this heading">#</a></h4>
<p>As we can see, the prediction intervals obtained using the Linear regression formula are too wide. So, we are interesting in other procedures to estimate prediction intervals that lead to narrower intervals. A possibility is to use a method based on Monte Carlo simulation.</p>
<p>Generate <span class="math notranslate nohighlight">\(k\)</span> values from <span class="math notranslate nohighlight">\(Poisson(\lambda=\widehat{y}_i)\)</span> <span class="math notranslate nohighlight">\(\hspace{0.12cm}\Rightarrow\hspace{0.12cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{\widehat{y}_i}= (\widetilde{\widehat{y}}_{i1},\widetilde{\widehat{y}}_{i2}, \dots , \widetilde{\widehat{y}}_{ik})^\prime\)</span></p>
<div class="math notranslate nohighlight">
\[PI({y}_i) = \left[Q_{\alpha/2}(\widetilde{\widehat{y}_i})\hspace{0.05cm} , \hspace{0.12cm}   Q_{1-\alpha/2}(\widetilde{\widehat{y}_i})   \right] \]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Q_{\alpha/2}(\widetilde{\widehat{y}_i})\)</span> is the <span class="math notranslate nohighlight">\(\alpha/2\)</span>-order quantile of <span class="math notranslate nohighlight">\(\widetilde{\widehat{y}_i}\)</span></p></li>
</ul>
<p>Let’s implement this alternative in <code class="docutils literal notranslate"><span class="pre">Python</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prediction_intervals_monte_carlo</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">,</span> <span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">)):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
    <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">simulation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test_hat</span><span class="p">),</span> <span class="n">n_simulations</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_simulations</span><span class="p">):</span>
       <span class="c1"># simulation_matrix has in its i-th row the simulations of Y_test_hat[i]</span>
       <span class="n">simulation_matrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">)</span>
    
    <span class="c1"># Compute quantiles per rows (axis=1) on simulation_matrix, i.e. </span>
    <span class="c1"># compute the appropriate quantiles of the Y_test_hat[i] simulations, for i=1,...,n</span>
    <span class="n">L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">simulation_matrix</span><span class="p">,</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># lower bound</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">simulation_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># upper bound</span>

    <span class="n">prop_Y_test_out_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">&lt;</span> <span class="n">L1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y_test</span> <span class="o">&gt;</span> <span class="n">L2</span><span class="p">))</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">subset_len</span> <span class="o">=</span> <span class="n">subset_len</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                      <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Predictions - Test&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;fuchsia&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Real Values - Test&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y_test_hat&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;X_test - Index [0:</span><span class="si">{</span><span class="n">subset_len</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction Intervals - Test Set&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.32</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The percentage of real values of the response (all the red points) that are out of the prediction intervals is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop_Y_test_out_interval</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction_intervals_monte_carlo</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]],</span> <span class="n">Y</span><span class="p">,</span> 
                                 <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                 <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">],</span> 
                                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span>
                                 <span class="n">n_simulations</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0bf730f2aa9880d278df17b1bc301bc15ed72a8cd66b64d8b2050482d02e2021.png" src="_images/0bf730f2aa9880d278df17b1bc301bc15ed72a8cd66b64d8b2050482d02e2021.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The percentage of real values of the response (all the red points) that are out of the prediction intervals is 26.94 %
</pre></div>
</div>
</div>
</div>
</section>
<section id="coefficient-interpretation-theory">
<h4><strong>Coefficient Interpretation: theory</strong><a class="headerlink" href="#coefficient-interpretation-theory" title="Link to this heading">#</a></h4>
<section id="without-interactions">
<h5><strong>Without interactions</strong><a class="headerlink" href="#without-interactions" title="Link to this heading">#</a></h5>
<p><strong>Interpretation of quantitative predictors</strong></p>
<p>Suppose that <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> is a <strong>quantitative</strong> variable.</p>
<p>We have the following estimation:</p>
<div class="math notranslate nohighlight">
\[\widehat{\eta}_i = \widehat{\beta}_0 + \widehat{\beta}_{1}\cdot x_{i1} + \dots +  \widehat{\beta}_{j} \cdot x_{ij} + \dots +   \widehat{\beta}_{p}\cdot x_{ip}\]</div>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, in sample terms, the new value of the variable <span class="math notranslate nohighlight">\(X_j\)</span> is <span class="math notranslate nohighlight">\(X_j + c\)</span>, and we can express this as <span class="math notranslate nohighlight">\(X'_j =X_j +c\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x'_{ij} = x_{ij}+h}{\widehat{\mu}_i |  x_{ij}} = \dfrac{e^{\widehat{\eta}_i |x'_{ij}} }{e^{\widehat{\eta}_i |x_{ij}}} = e^{\widehat{\eta}_i |x'_{ij} - \widehat{\eta}_i |x_{ij}} = e^{h  \widehat{\beta}_j}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x'_{ij} = x_{ij}+h}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{h  \widehat{\beta}_j} \cdot \widehat{\mu}_i |  \small{x_{ij}}\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j &gt; 0 \hspace{0.2cm} (e^{h  \widehat{\beta}_j} &gt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{h  \widehat{\beta}_j}\)</span> times higher if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j &lt; 0 \hspace{0.2cm} (e^{h  \widehat{\beta}_j} &lt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(1 / e^{h  \widehat{\beta}_j}\)</span> times lower if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
<p>Observation: the reasoning is analogous if the predictor decreases rather than increases, but in the opposite sense.</p>
</li>
</ul>
<p><strong>Interpretation of categorical predictors</strong></p>
<p>Suppose that <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> is a <strong>categorical</strong> variable with <span class="math notranslate nohighlight">\(g\)</span> categories <span class="math notranslate nohighlight">\((Range(\mathcal{X}_j) = \lbrace 0,1,\dots, g-1\rbrace)\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> enter in the model with <span class="math notranslate nohighlight">\(g-1\)</span> dummy predictors. Considering <span class="math notranslate nohighlight">\(0\)</span> as the reference category, these dummy predictors that enter in the model to represent <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> are the following:</p>
<div class="math notranslate nohighlight">
\[X_{j1},X_{j2},\dots , X_{j(g-1)}\]</div>
<p>with their associated beta parameters:</p>
<div class="math notranslate nohighlight">
\[\beta_{j1}, \beta_{j2}, \dots , \beta_{j(g-1)}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}x_{ijr} = \begin{cases}
             1, \quad x_{ij} = r \\
             0, \quad x_{ij} \neq r
             \end{cases}\end{split}\]</div>
<p>Note that <span class="math notranslate nohighlight">\(x_{ijr} = 1\)</span> is equivalent to <span class="math notranslate nohighlight">\(x_{ij} = r\)</span>, and <span class="math notranslate nohighlight">\(x_{ij}=0\)</span> is equivalent to <span class="math notranslate nohighlight">\(x_{ijr}=0\)</span> for all <span class="math notranslate nohighlight">\(\small{r=1,2, \dots, g-1}\)</span>.</p>
<p>The estimation  would be:</p>
<div class="math notranslate nohighlight">
\[\widehat{\eta}_i = \widehat{\beta}_0 + \widehat{\beta}_{1}\cdot x_{i1} +  \dots +  \widehat{\beta}_{j1} \cdot x_{i j1} + \widehat{\beta}_{j2} \cdot x_{i j2} + \dots + \widehat{\beta}_{j(g-1)} \cdot x_{i j(g-1)} + \dots +   \widehat{\beta}_{p}\cdot x_{ip}\]</div>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(0\)</span> (the reference category):</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x_{ij} = r}{\widehat{\mu}_i |  x_{ij} = 0} = \dfrac{e^{\widehat{\eta}_i |x_{ijr} = 1} }{e^{\widehat{\eta}_i |x_{ij}=0}} = e^{\widehat{\eta}_i |x_{ijr} = 1 - \widehat{\eta}_i |x_{ij}=0} = e^{ \widehat{\beta}_{jr}}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{ \widehat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &gt; 0 \hspace{0.2cm} (e^{\widehat{\beta}_{jr}} &gt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{\widehat{\beta}_{jr}}\)</span> times higher if <span class="math notranslate nohighlight">\(x_{ij}=r\)</span>  than if <span class="math notranslate nohighlight">\(x_{ij}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &lt; 0 \hspace{0.2cm} (e^{\widehat{\beta}_{jr}} &lt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(1 / e^{\widehat{\beta}_{jr}}\)</span> times lower if <span class="math notranslate nohighlight">\(x_{ij}=r\)</span> than if <span class="math notranslate nohighlight">\(x_{ij}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r_1\)</span> and <span class="math notranslate nohighlight">\(r_2\)</span> (the reference category):</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x_{ij} = r_1}{\widehat{\mu}_i |  x_{ij} = r_2} = \dfrac{e^{\widehat{\eta}_i |x_{ijr_1} = 1} }{e^{\widehat{\eta}_i |x_{ijr_2}=1}} = e^{\widehat{\eta}_i |x_{ijr_1} = 1 - \widehat{\eta}_i |x_{ijr_2}=1} = e^{ \widehat{\beta}_{jr_1} - \widehat{\beta}_{jr_2}}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r_1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{ \widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2}} \cdot \widehat{\mu}_i |  \small{x_{ij}=r_2}\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2} &gt; 0 \hspace{0.2cm} (e^{ \widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2}}  &gt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{ \widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2}}\)</span> times higher if <span class="math notranslate nohighlight">\(x_{ij}=r_1\)</span>  thant if <span class="math notranslate nohighlight">\(x_{ij}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &lt; 0 \hspace{0.2cm} (e^{ \widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2}}  &lt; 1)\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(1 / e^{ \widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2}}\)</span> times lower if <span class="math notranslate nohighlight">\(x_{ij}=r_1\)</span> thant if <span class="math notranslate nohighlight">\(x_{ij}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="with-interactions">
<h5><strong>With interactions</strong><a class="headerlink" href="#with-interactions" title="Link to this heading">#</a></h5>
<p>Suppose that <span class="math notranslate nohighlight">\(X_{j}\)</span> is quantitative and <span class="math notranslate nohighlight">\(X_h\)</span> is categorical with <span class="math notranslate nohighlight">\(g\)</span> categories <span class="math notranslate nohighlight">\(\lbrace 0, 1, \dots, g-1\rbrace\)</span> and the reference category is <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>And also suppose that the model includes an interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_h\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}\widehat{\eta}_i = \widehat{\beta}_0 + \dots + \widehat{\beta}_j\cdot x_{ij} 
+ \widehat{\beta}_{h1} \cdot x_{i h1} + \dots + \widehat{\beta}_{h(g-1)} \cdot x_{i h(g-1)} + \\[0.15cm]\end{split}\\+ \widehat{\beta}_{jh1}\cdot x_{ij}\cdot x_{ih1} + \dots +   \widehat{\beta}_{jh(g-1)}\cdot x_{ij}\cdot x_{ih(g-1)}\end{aligned}\end{align} \]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widehat{\beta}_{jh}\)</span> is the coefficient fot he interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_k\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{\beta}_{jhr}\)</span> is the coefficient fot he interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_{hr}\)</span> (the dummy variable associated to the category <span class="math notranslate nohighlight">\(r\)</span> of <span class="math notranslate nohighlight">\(X_h\)</span>), for <span class="math notranslate nohighlight">\(\small{r=1,2,\dots,g-1}.\)</span></p></li>
</ul>
<p><strong>Quantitative predictors:</strong></p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, in sample terms, the new value of the variable <span class="math notranslate nohighlight">\(X_j\)</span> is <span class="math notranslate nohighlight">\(X_j + w\)</span>, and we can express this as <span class="math notranslate nohighlight">\(X'_j =X_j +w\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x'_{ij} = x_{ij}+h}{\widehat{\mu}_i |  x_{ij}} = \dfrac{e^{\widehat{\eta}_i |x'_{ij}} }{e^{\widehat{\eta}_i |x_{ij}}} = e^{\widehat{\eta}_i |x'_{ij} - \widehat{\eta}_i |x_{ij}} = e^{\phi(\cdot)}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x'_{ij} = x_{ij}+w}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\phi(\cdot)} \cdot \widehat{\mu}_i |  \small{x_{ij}}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) = \phi\left(x_{ih1}, x_{ih2}, \dots, x_{ih(g-1)}\right) = w\cdot \widehat{\beta}_j + w\cdot x_{ih1} \cdot \widehat{\beta}_{jh1}+ \dots + w\cdot x_{ih(g-1)} \cdot \widehat{\beta}_{jh(g-1)}\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the categorical predictor with which an interaction has been set.</p>
<p>Let’s suppose an individual with <span class="math notranslate nohighlight">\(x_{ih} = r\)</span>, i.e. <span class="math notranslate nohighlight">\(x_{ihr}=1\)</span>, then <span class="math notranslate nohighlight">\(\phi(\cdot) = w\cdot (\widehat{\beta}_j + \widehat{\beta}_{jhr})\)</span>.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j + \widehat{\beta}_{jhr} &gt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{w (\widehat{\beta}_j + \widehat{\beta}_{jhr})} &gt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{w \hspace{0.05cm} \cdot (\widehat{\beta}_j + \widehat{\beta}_{jhr})} \)</span> times higher if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j + \widehat{\beta}_{jhr} &lt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{w (\widehat{\beta}_j + \widehat{\beta}_{jhr})} &lt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{w(\widehat{\beta}_j + \widehat{\beta}_{jhr})} \)</span> times lower if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
<p>Observation: the reasoning is analogous if the predictor decreases rather than increases, but in the opposite sense.</p>
</li>
</ul>
<p><strong>Categorical predictors:</strong></p>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(0\)</span> (the reference category) in <span class="math notranslate nohighlight">\(X_h\)</span>:</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x_{ih} = r}{\widehat{\mu}_i |  x_{ih}=0} = \dfrac{e^{\widehat{\eta}_i | x_{ih} = r} }{e^{\widehat{\eta}_i |x_{ih}=0}} = e^{\widehat{\eta}_i |x_{ih}=r - \widehat{\eta}_i |x_{ih}=0} = e^{\phi(\cdot)}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\phi(\cdot)} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) = \phi(x_{ij}) = \widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the quantitative predictor with which an interaction has been set.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr} &gt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}} &gt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}} \)</span> times higher if <span class="math notranslate nohighlight">\(x_{ih}=r\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr} &lt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}} &lt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}} \)</span> times lower if <span class="math notranslate nohighlight">\(x_{ih}=r\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r_1\)</span> and <span class="math notranslate nohighlight">\(r_2\)</span> (the reference category) in <span class="math notranslate nohighlight">\(X_h\)</span>:</p>
<div class="math notranslate nohighlight">
\[odds = \dfrac{\widehat{\mu}_i | x_{ih} = r_1}{\widehat{\mu}_i |  x_{ih}=r_2} = \dfrac{e^{\widehat{\eta}_i | x_{ih} = r_1} }{e^{\widehat{\eta}_i |x_{ih}=r_2}} = e^{\widehat{\eta}_i |x_{ih}=r_1 - \widehat{\eta}_i |x_{ih}=r_2} = e^{\phi(\cdot)}\]</div>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r_1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\phi(\cdot)} \cdot \widehat{\mu}_i |  \small{x_{ij}=r_2}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) = \phi(x_{ij}) = (\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2})\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the quantitative predictor with which an interaction has been set.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\((\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2}) &gt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{\phi(\cdot)} &gt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{\phi(\cdot)} \)</span> times higher if <span class="math notranslate nohighlight">\(x_{ih}=r_1\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\((\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2}) &lt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm} (e^{\phi(\cdot)} &lt; 1)\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{\mu}_i\)</span> is <span class="math notranslate nohighlight">\(e^{\phi(\cdot)}\)</span> times lower if <span class="math notranslate nohighlight">\(x_{ih}=r_1\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="coefficient-interpretation-application">
<h4><strong>Coefficient Interpretation: application</strong><a class="headerlink" href="#coefficient-interpretation-application" title="Link to this heading">#</a></h4>
<p>The best model for prediction may not be the best for interpretation.</p>
<p>In order to make this section more complete, we will use a model with interactions and dummies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_interpretation</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;CholCheck&#39;</span><span class="p">,</span> <span class="s1">&#39;NoDocbcCost&#39;</span><span class="p">,</span> <span class="s1">&#39;DiffWalk&#39;</span><span class="p">,</span> <span class="s1">&#39;HvyAlcoholConsump&#39;</span><span class="p">,</span> <span class="s1">&#39;Smoker&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">]</span>
<span class="n">interactions_interpretation</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">)]</span>
<span class="n">pred_to_dummies_interpretation</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_interpretation</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interpretation_model</span> <span class="o">=</span> <span class="n">poisson_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_interpretation</span><span class="p">])</span>
<span class="n">interpretation_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_interpretation</span><span class="p">,</span> 
                                                    <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_interpretation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">interpretation_model</span><span class="o">.</span><span class="n">poisson_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    GeneralizedPoisson Regression Results                     
==============================================================================
Dep. Variable:               MentHlth   No. Observations:                49484
Model:             GeneralizedPoisson   Df Residuals:                    49476
Method:                           MLE   Df Model:                            7
Date:                Fri, 29 Dec 2023   Pseudo R-squ.:                 0.03991
Time:                        11:11:53   Log-Likelihood:                -85707.
converged:                      False   LL-Null:                       -89269.
Covariance Type:            nonrobust   LLR p-value:                     0.000
=======================================================================================
                          coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------------
PhysHlth                0.0380      0.001     43.704      0.000       0.036       0.040
CholCheck_1             0.7436      0.020     36.393      0.000       0.704       0.784
Smoker_1                0.1514      0.016      9.480      0.000       0.120       0.183
HvyAlcoholConsump_1     0.3477      0.035      9.824      0.000       0.278       0.417
NoDocbcCost_1           0.7828      0.021     38.157      0.000       0.743       0.823
DiffWalk_1              0.3300      0.019     17.369      0.000       0.293       0.367
Sex_1                  -0.4424      0.021    -21.213      0.000      -0.483      -0.402
PhysHlth:Sex_1          0.0019      0.001      1.466      0.143      -0.001       0.004
alpha                   5.9168      0.102     58.129      0.000       5.717       6.116
=======================================================================================
</pre></div>
</div>
</div>
</div>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">PhysHlth</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">PhisHlth</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span> and <code class="docutils literal notranslate"><span class="pre">Sex</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x'_{ij} = x_{ij}+w}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\phi(\cdot)} \cdot \widehat{\mu}_i |  \small{x_{ij}}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) =  w\cdot \widehat{\beta}_j + w\cdot x_{ih1} \cdot \widehat{\beta}_{jh1}+ \dots + c\cdot x_{ih(g-1)} \cdot \widehat{\beta}_{jh(g-1)}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0, 1\rbrace\)</span>, since <code class="docutils literal notranslate"><span class="pre">Sex</span></code> is a binary variable, therefore:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) =  w\cdot \widehat{\beta}_j + w\cdot x_{ih1} \cdot \widehat{\beta}_{jh1} =w\cdot\left( \widehat{\beta}_j +  x_{ih1} \cdot \widehat{\beta}_{jh1} \right) = w\cdot\left( 0.038 +  x_{ih1} \cdot 0.002 \right)\]</div>
<p>If <span class="math notranslate nohighlight">\(x_{ih1} = 1\)</span>, in other words, <code class="docutils literal notranslate"><span class="pre">Sex=1</span></code> (male), then:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x'_{ij} = x_{ij}+w}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{ w\cdot 0.04} \cdot \widehat{\mu}_i |  \small{x_{ij}}\]</div>
<p>Since:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) =  w\cdot 0.04\]</div>
<p>Therefore:</p>
<ul class="simple">
<li><p>If the number of days with not good physical health (in the last 30 gays) of a <strong>male</strong> increases in 1 day <span class="math notranslate nohighlight">\((w=1)\)</span>, then the average number of days with bad mental health (in the las 30 days) is <span class="math notranslate nohighlight">\(1.04\)</span> times greater. And if the increment is in 10 days <span class="math notranslate nohighlight">\((w=10)\)</span> of bad physical health, the increment in the bad mental health is in <span class="math notranslate nohighlight">\(1.50\)</span> times.</p></li>
<li><p>For males, when the number of days with bad physical health increases, the number of days with poor mental health increases as well. And, the more days with bad physical health, the more days with bad mental health. And, higher increases in the number of days with bad physical healths lead to higher increases in the number of days with poor mental health.</p></li>
</ul>
<p>If <span class="math notranslate nohighlight">\(x_{ih1} = 0\)</span>, in other words, <code class="docutils literal notranslate"><span class="pre">Sex=0</span></code> (female), then:</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x'_{ij} = x_{ij}+w}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{ w\cdot 0.038} \cdot \widehat{\mu}_i |  \small{x_{ij}}\]</div>
<p>Since:</p>
<div class="math notranslate nohighlight">
\[\phi(\cdot) =  w\cdot 0.038\]</div>
<p>Therefore:</p>
<ul class="simple">
<li><p>If the number of days with not good physical health (in the last 30 gays) of a <strong>female</strong> increases in 1 day <span class="math notranslate nohighlight">\((w=1)\)</span>, then the average number of days with bad mental health (in the las 30 days) is <span class="math notranslate nohighlight">\(1.038\)</span> times greater. And if the increment is in 10 days <span class="math notranslate nohighlight">\((w=10)\)</span> of bad physical health, the increment in the bad mental health is in <span class="math notranslate nohighlight">\(1.46\)</span> times.</p></li>
<li><p>For females, when the number of days with bad physical health increases, the number of days with poor mental health increases as well. And, the more days with bad physical health, the more days with bad mental health. And, higher increases in the number of days with bad physical healths lead to higher increases in the number of days with poor mental health.</p></li>
</ul>
<p>So, for both males and females, if they experiment an increases in the number off days with bad physical health, they will experiment an increases in the number of days with poor mental health as well, but in the case of males with a little bit higher intensity than females.</p>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">CholCheck</span></code></strong></p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\widehat{\beta}_{j1}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{0.74} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}   \hspace{0.15cm}  \\[0.3cm] \hspace{1.3cm} = 2.1 \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul class="simple">
<li><p>People with cholesterol check in the last 5 years have on average <span class="math notranslate nohighlight">\(2.1\)</span> times more days with poor mental health than people without cholesterol check.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">Smoker</span></code></strong></p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{j1}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{0.1514} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}   \hspace{0.15cm}  \\[0.3cm] \hspace{1.3cm} = 1.16 \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul class="simple">
<li><p>Smokers have on average <span class="math notranslate nohighlight">\(1.16\)</span> times more days with poor mental health than no smokers.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">HvtAlcoholConsump</span></code></strong></p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{j1}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{0.348} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}   \hspace{0.15cm}  \\[0.3cm] \hspace{1.3cm} = 1.41 \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul class="simple">
<li><p>Heavy alcohol consumers have on average <span class="math notranslate nohighlight">\(1.41\)</span> times more days of poor mental health than not heavy consumers.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">NoDobcCost</span></code></strong></p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{j1}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{0.783} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}   \hspace{0.15cm}  \\[0.3cm] \hspace{1.3cm} = 2.19 \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul class="simple">
<li><p>People that cannot afford medical services (sometime in the last 12 months) have on average <span class="math notranslate nohighlight">\(2.19\)</span> times more days of poor mental health than people who can.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">Diffwalk</span></code></strong></p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{jr}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\hat{\beta}_{j1}} \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{0.33} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}   \hspace{0.15cm}  \\[0.3cm] \hspace{1.3cm} = 1.40 \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul class="simple">
<li><p>People with difficulties for walking have on average <span class="math notranslate nohighlight">\(1.40\)</span> times more days of poor mental health  than people without.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">Sex</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">PhisHlth</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span> and <code class="docutils literal notranslate"><span class="pre">Sex</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span>, as we said before.</p>
<div class="math notranslate nohighlight">
\[\widehat{\mu}_i | \small{x_{ij} = r}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\widehat{\beta}_{hr} + x_{ij}\cdot \widehat{\beta}_{jhr} } \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(r\in \lbrace 0,1\rbrace\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ij} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{\widehat{\beta}_{h1} + x_{ij}\cdot \widehat{\beta}_{jh1} } \cdot \widehat{\mu}_i |  \small{x_{ij}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = e^{-0.44 + x_{ij}\cdot 0.002} \cdot \widehat{\mu}_i |  \small{x_{ij}=0}\end{split}\]</div>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_{ij}=1\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ih} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{-0.44 +   0.002} \cdot \widehat{\mu}_i |  \small{x_{ih}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = 0.65 \cdot \widehat{\mu}_i |  \small{x_{ih}=0}\end{split}\]</div>
<ul class="simple">
<li><p>For people with <span class="math notranslate nohighlight">\(1\)</span> day with bad physical health (in the las 30 days), females have on average <span class="math notranslate nohighlight">\(1.54\)</span> times more days of poor mental health than males.</p></li>
</ul>
</li>
</ul>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_{ij}=10\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ih} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{-0.44 +   0.02} \cdot \widehat{\mu}_i |  \small{x_{ih}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = 0.66 \cdot \widehat{\mu}_i |  \small{x_{ih}=0}\end{split}\]</div>
<ul class="simple">
<li><p>For people with <span class="math notranslate nohighlight">\(10\)</span> days with bad physical health (in the las 30 days), females have on average <span class="math notranslate nohighlight">\(1.51\)</span> times more days of poor mental health than males.</p></li>
</ul>
</li>
</ul>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_{ij}=30\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\mu}_i | \small{x_{ih} = 1}  \hspace{0.15cm} =   \hspace{0.15cm}  e^{-0.44 +   0.02} \cdot \widehat{\mu}_i |  \small{x_{ih}=0} \hspace{0.15cm}  \\[0.3cm]  \hspace{1.6cm} = 0.68 \cdot \widehat{\mu}_i |  \small{x_{ih}=0}\end{split}\]</div>
<ul class="simple">
<li><p>For people with <span class="math notranslate nohighlight">\(30\)</span> days with bad physical health (in the las 30 days), females have on average <span class="math notranslate nohighlight">\(1.47\)</span> times more days of poor mental health than males.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Therefore, given a number of days with not good physical health, females have on average more days with poor mental health than males, but this difference is <strong>slightly</strong> lower when the number of days with not good physical health increases.</p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Modeling Mental Health</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing"><strong>Data preprocessing</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-encoding"><strong>Standard encoding</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-data-types"><strong>Changing  data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#poisson-model"><strong>Poisson Model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-poisson-regression"><strong>Why Poisson regression?</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation"><strong>Estimation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-deviation-of-coefficients"><strong>Standard deviation of coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-coefficients"><strong>Confidence intervals for  coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction"><strong>Prediction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection"><strong>Predictors Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-test"><strong>Significance test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit"><strong>Goodness of fit</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#deviance"><strong>Deviance</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-ratio-test-as-significance-test"><strong>Likelihood Ratio Test as significance test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection-based-on-predictive-performance"><strong>Predictors selection based on predictive performance</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#train-train-train-validate-split"><strong>Train-Train - Train-Validate split</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection-algorithm"><strong>Best subset selection algorithm</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection-algorithm"><strong>Backward selection algorithm</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-algorithm"><strong>Forward selection algorithm</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction intervals</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-monte-linear-regression-formula"><strong>Using Monte Linear Regression formula</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-monte-carlo-simulation"><strong>Using Monte Carlo Simulation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-theory"><strong>Coefficient Interpretation: theory</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#without-interactions"><strong>Without interactions</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#with-interactions"><strong>With interactions</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-application"><strong>Coefficient Interpretation: application</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>